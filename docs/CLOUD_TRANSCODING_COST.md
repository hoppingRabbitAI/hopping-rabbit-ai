# 云函数/转码服务成本分析

## 概述

当用户规模扩大后，可考虑迁移到云转码服务，以下是各方案成本对比。

---

## 方案对比

### 方案A：AWS Lambda + S3（DIY）

| 项目 | 单价 | 2GB视频/次 | 10视频/天 月成本 |
|------|------|-----------|-----------------|
| Lambda 执行 | $0.0000166/GB-s | ~$0.05 | ~$15 |
| S3 存储 | $0.023/GB/月 | 忽略 | - |
| S3 传输 | $0.09/GB | ~$0.18 | ~$5 |
| **总计** | - | - | **~$20** |

**优点**：灵活、可控
**缺点**：需要自己写代码、维护

### 方案B：AWS Elastic Transcoder

| 项目 | 单价 |
|------|------|
| SD 视频 (480p) | $0.015/分钟 |
| HD 视频 (720p/1080p) | $0.030/分钟 |
| 4K 视频 | $0.060/分钟 |

**示例**：5分钟 1080p 视频 = $0.15

| 规模 | 月成本 |
|------|--------|
| 10视频/天 | ~$45 |
| 100视频/天 | ~$450 |

**优点**：托管服务、稳定
**缺点**：成本较高

### 方案C：AWS MediaConvert

| 项目 | 单价 |
|------|------|
| 基本转码 | $0.0075/分钟 |
| 专业级转码 | $0.024/分钟 |

比 Elastic Transcoder 便宜约 50%。

### 方案D：Azure Media Services

| 项目 | 单价 |
|------|------|
| 标准编码 | $0.015/分钟 |
| 高级编码 | $0.030/分钟 |

与 AWS Elastic Transcoder 类似。

### 方案E：Cloudflare Stream（推荐小规模）

| 项目 | 单价 |
|------|------|
| 存储 | $5/1000分钟视频 |
| 播放 | $1/1000分钟观看 |

**特点**：
- 自动转码为多码率 HLS
- 自带 CDN 加速
- 无需管理基础设施

| 规模 | 月成本 |
|------|--------|
| 500分钟存储 + 5000分钟播放 | ~$10 |
| 5000分钟存储 + 50000分钟播放 | ~$80 |

### 方案F：Mux Video

| 项目 | 单价 |
|------|------|
| 编码 | $0.015/分钟 |
| 存储 | 免费（90天） |
| 播放 | $0.00096/分钟 |

与 Cloudflare Stream 竞品，API 更好用。

---

## 成本汇总表

| 方案 | 10视频/天 | 100视频/天 | 复杂度 | 推荐场景 |
|------|----------|-----------|--------|---------|
| 自建服务器 | $0 | 服务器成本 | 高 | 开发测试 |
| AWS Lambda | ~$20 | ~$200 | 中 | 技术团队强 |
| AWS MediaConvert | ~$25 | ~$250 | 低 | 企业级 |
| Cloudflare Stream | ~$10 | ~$80 | **最低** | **推荐** |
| Mux Video | ~$15 | ~$120 | 低 | API优先 |

---

## 迁移建议

### 阶段1：当前（0-1000用户）
- 使用 **faststart + 队列限流**
- 小视频（<50MB, <30s）：faststart 优化，5-15秒可播放
- 大视频（>50MB 或 >30s）：HLS 转码，30-90秒（⚠️ 已知问题，待迁移解决）
- 成本：$0（仅服务器费用）

### 阶段2：增长期（1000-10000用户）⭐ 计划采用
- 迁移到 **Cloudflare Stream**
- 所有视频统一走 Cloudflare 处理
- 彻底解决大视频转码慢的问题
- 成本：$50-200/月

### 阶段3：规模化（10000+用户）
- 使用 **AWS MediaConvert** + 自建 CDN
- 成本：$500+/月，但更可控

---

## 实施清单

- [ ] 评估当前用户量和视频上传量
- [ ] 选择合适的云服务商
- [ ] 修改上传流程对接云转码 API
- [ ] 配置回调处理转码完成事件
- [ ] 更新前端播放逻辑
- [ ] 监控成本和性能

---

*文档创建时间：2026-01-28*
