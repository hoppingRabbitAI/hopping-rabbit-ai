# Remotion Agent è®¾è®¡æ–‡æ¡£

> ä¸ºçŸ¥è¯†ç±»åšä¸»è®¾è®¡çš„æ™ºèƒ½è§†é¢‘è§†è§‰ç¼–æ’ç³»ç»Ÿ

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 é—®é¢˜åˆ†æ

å½“å‰çŸ¥è¯†ç±»åšä¸»è§†é¢‘åˆ¶ä½œé¢ä¸´çš„ç—›ç‚¹ï¼š
- å£æ’­ç”»é¢å•è°ƒï¼Œè§‚ä¼—å®¹æ˜“ç–²åŠ³
- B-Roll ç´ æé€‰æ‹©éšæ„ï¼Œä¸å†…å®¹å…³è”åº¦ä½
- ç¼ºä¹ä¸“ä¸šçš„è§†è§‰å‘ˆç°ï¼ˆæ•°æ®å›¾è¡¨ã€è¦ç‚¹åˆ—è¡¨ç­‰ï¼‰
- é‡ç‚¹å†…å®¹æ²¡æœ‰è§†è§‰å¼ºè°ƒï¼Œè§‚ä¼—éš¾ä»¥æŠ“ä½æ ¸å¿ƒ

### 1.2 ç›®æ ‡

æ‰“é€ ä¸€ä¸ªæ™ºèƒ½è§†è§‰ç¼–æ’ Agentï¼Œèƒ½å¤Ÿï¼š
1. **ç†è§£å†…å®¹ç»“æ„** - è¯†åˆ«è§†é¢‘çš„ç« èŠ‚ã€è¦ç‚¹ã€æ•°æ®ç­‰
2. **åŒ¹é…è§†è§‰å½¢å¼** - ä¸ºä¸åŒå†…å®¹ç±»å‹é€‰æ‹©æœ€ä½³å‘ˆç°æ–¹å¼
3. **ç”Ÿæˆ Remotion é…ç½®** - è¾“å‡ºå¯ç›´æ¥æ¸²æŸ“çš„ç»„ä»¶é…ç½®
4. **è‡ªåŠ¨åŒ–ç´ æè·å–** - B-Roll æœç´¢ã€å›¾è¡¨ç”Ÿæˆç­‰

---

## 2. çŸ¥è¯†ç±»è§†é¢‘å½¢æ€åˆ†æ

### 2.1 å¸¸è§å†…å®¹ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŸ¥è¯†ç±»åšä¸»è§†é¢‘å†…å®¹ç»“æ„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£ å¼€åœºå¼•å…¥ (Hook)                                             â”‚
â”‚     â””â”€ æŠ›å‡ºé—®é¢˜/ç—›ç‚¹/æ•°æ®å†²å‡»/æ‚¬å¿µ                                â”‚
â”‚        ä¾‹: "90%çš„äººä¸çŸ¥é“è¿™ä¸ªæŠ€å·§"                                â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£ ä¸»ä½“å†…å®¹ (Body) - ä»¥ä¸‹å½¢å¼çš„ç»„åˆ                              â”‚
â”‚     â”œâ”€ ğŸ“‹ è¦ç‚¹åˆ—è¡¨å‹: "ä»Šå¤©åˆ†äº«3ä¸ªæ–¹æ³•..."                         â”‚
â”‚     â”œâ”€ ğŸ”„ æµç¨‹æ­¥éª¤å‹: "ç¬¬ä¸€æ­¥...ç¬¬äºŒæ­¥..."                         â”‚
â”‚     â”œâ”€ ğŸ†š å¯¹æ¯”åˆ†æå‹: "Aæ–¹æ¡ˆ vs Bæ–¹æ¡ˆ"                            â”‚
â”‚     â”œâ”€ ğŸ“Š æ•°æ®å±•ç¤ºå‹: "å¢é•¿äº†300%..."                             â”‚
â”‚     â”œâ”€ ğŸ§  æ¦‚å¿µè§£é‡Šå‹: "ä»€ä¹ˆæ˜¯xxxï¼Ÿ"                               â”‚
â”‚     â””â”€ ğŸ“– æ•…äº‹æ¡ˆä¾‹å‹: "æˆ‘ä¹‹å‰é‡åˆ°è¿‡..."                           â”‚
â”‚                                                                 â”‚
â”‚  3ï¸âƒ£ æ€»ç»“æ”¶å°¾ (CTA)                                              â”‚
â”‚     â””â”€ å›é¡¾è¦ç‚¹/è¡ŒåŠ¨å·å¬/äº’åŠ¨å¼•å¯¼                                  â”‚
â”‚        ä¾‹: "å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œç‚¹èµæ”¶è—"                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å†…å®¹ç±»å‹ä¸è§†è§‰å½¢å¼æ˜ å°„

| å†…å®¹ç±»å‹ | å…¸å‹è¡¨è¿° | æ¨èè§†è§‰å½¢å¼ | ç¤ºä¾‹ |
|---------|---------|-------------|------|
| å¼€åœºHook | "ä½ çŸ¥é“å—..." | å¤§å­—æ ‡é¢˜ + éœ‡æ’¼æ•°æ® | å…¨å±æ˜¾ç¤º"90%çš„äººéƒ½é”™äº†" |
| è¦ç‚¹åˆ—è¡¨ | "ç¬¬ä¸€ç‚¹æ˜¯..." | ç”»å¸ƒé€æ¡å±•ç¤º | å·¦ä¾§åˆ—è¡¨ï¼Œè¯´åˆ°å“ªä¸ªäº®å“ªä¸ª |
| æµç¨‹æ­¥éª¤ | "é¦–å…ˆ...ç„¶å..." | æµç¨‹å›¾/æ—¶é—´çº¿ | èŠ‚ç‚¹ä¾æ¬¡ç‚¹äº®è¿çº¿ |
| å¯¹æ¯”åˆ†æ | "Aæ¯”Bæ›´..." | åˆ†å±/å¯¹æ¯”è¡¨æ ¼ | å·¦å³å¯¹æ¯”ï¼Œä¼˜åŠ£æ ‡æ³¨ |
| æ•°æ®å±•ç¤º | "å¢é•¿äº†300%" | æ•°å­—åŠ¨ç”»/å›¾è¡¨ | æ•°å­—æ»šåŠ¨ã€æŸ±çŠ¶å›¾å¢é•¿ |
| æ¦‚å¿µè§£é‡Š | "ä»€ä¹ˆæ˜¯xxx" | å…³é”®è¯å¡ç‰‡ + å›¾è§£ | æ ¸å¿ƒæ¦‚å¿µå±…ä¸­æ˜¾ç¤º |
| æ•…äº‹æ¡ˆä¾‹ | "æ¯”å¦‚è¯´..." | B-Roll + å­—å¹• | ç”»é¢åˆ‡èµ°è®²æ•…äº‹ |
| ç›´æ¥äº’åŠ¨ | "ä½ ä»¬è§‰å¾—å‘¢" | ä¿æŒå£æ’­ | è§‚ä¼—éœ€è¦çœ‹åˆ°è¡¨æƒ… |
| æ€»ç»“å›é¡¾ | "æ€»ç»“ä¸€ä¸‹" | è¦ç‚¹å›é¡¾åˆ—è¡¨ | å…¨éƒ¨è¦ç‚¹åŒæ—¶æ˜¾ç¤º |

---

## 3. Agent æ•´ä½“æ¶æ„

### 3.1 ä¸‰é˜¶æ®µå¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Remotion Agent Pipeline                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Stage 1   â”‚â”€â”€â”€â–¶â”‚   Stage 2   â”‚â”€â”€â”€â–¶â”‚   Stage 3   â”‚                   â”‚
â”‚  â”‚  å†…å®¹ç†è§£    â”‚    â”‚  ç»“æ„åˆ†æ    â”‚    â”‚  è§†è§‰ç¼–æ’    â”‚                   â”‚
â”‚  â”‚ (LLM Call)  â”‚    â”‚ (LLM Call)  â”‚    â”‚  (è§„åˆ™+LLM) â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚        â”‚                  â”‚                  â”‚                           â”‚
â”‚        â–¼                  â–¼                  â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ â€¢ è¯†åˆ«ä¸»é¢˜   â”‚    â”‚ â€¢ åˆ’åˆ†ç« èŠ‚   â”‚    â”‚ â€¢ é€‰æ‹©ç»„ä»¶   â”‚                   â”‚
â”‚  â”‚ â€¢ æå–å…³é”®è¯ â”‚    â”‚ â€¢ è¯†åˆ«å†…å®¹å‹ â”‚    â”‚ â€¢ è®¾è®¡åŠ¨ç”»   â”‚                   â”‚
â”‚  â”‚ â€¢ åˆ¤æ–­é£æ ¼   â”‚    â”‚ â€¢ æ ‡è®°é‡ç‚¹   â”‚    â”‚ â€¢ æ—¶é—´ç¼–æ’   â”‚                   â”‚
â”‚  â”‚ â€¢ å—ä¼—ç”»åƒ   â”‚    â”‚ â€¢ æå–æ•°æ®   â”‚    â”‚ â€¢ é…ç½®å‚æ•°   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                          â”‚
â”‚                              â–¼ æœ€ç»ˆè¾“å‡º                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚   Remotion Config   â”‚                               â”‚
â”‚                    â”‚  (JSON, å¯ç›´æ¥æ¸²æŸ“)  â”‚                               â”‚
â”‚                    â”‚  æ‰€æœ‰è§†è§‰å…ƒç´ ç”±       â”‚                               â”‚
â”‚                    â”‚  Remotion ç»„ä»¶ç”Ÿæˆ   â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **è®¾è®¡åŸåˆ™**: æ‰€æœ‰è§†è§‰å…ƒç´ ï¼ˆå›¾è¡¨ã€åŠ¨ç”»ã€æ ·å¼ï¼‰å‡ç”± Remotion ç»„ä»¶æ¸²æŸ“ï¼Œä¸ä¾èµ–å¤–éƒ¨ç´ æ API

### 3.2 æ•°æ®æµè½¬

```
è¾“å…¥: ASR è½¬å†™ç‰‡æ®µ
  â”‚
  â–¼
Stage 1: ContentUnderstanding
  â”‚ { topic, category, tone, globalKeywords, targetAudience }
  â–¼
Stage 2: StructuredSegments
  â”‚ [ { id, text, role, contentType, importance, extractedData } ]
  â–¼
Stage 3: VisualConfig (æœ€ç»ˆè¾“å‡º)
  â”‚ { canvas, overlays[], mainVideo, subtitles }
  â–¼
è¾“å‡º: å¯æ¸²æŸ“çš„ Remotion ç»„ä»¶æ ‘ (çº¯å‰ç«¯æ¸²æŸ“ï¼Œæ— éœ€å¤–éƒ¨ç´ æ)
```

---

## 4. å„é˜¶æ®µè¯¦ç»†è®¾è®¡

### 4.1 Stage 1: å†…å®¹ç†è§£å±‚

**èŒè´£**: ç†è§£è§†é¢‘çš„æ•´ä½“ä¸»é¢˜ã€é£æ ¼ã€å—ä¼—

**è¾“å…¥**: å®Œæ•´è½¬å†™æ–‡æœ¬

**è¾“å‡º**:
```typescript
interface ContentUnderstanding {
  // è§†é¢‘ä¸»é¢˜ (ä¸€å¥è¯æ¦‚æ‹¬)
  topic: string;
  
  // å†…å®¹ç±»åˆ«
  category: 'tutorial' | 'analysis' | 'review' | 'story' | 'opinion' | 'news';
  
  // æƒ…æ„ŸåŸºè°ƒ (å½±å“é…è‰²å’ŒåŠ¨ç”»é£æ ¼)
  tone: 'educational' | 'inspiring' | 'casual' | 'serious' | 'humorous';
  
  // å…¨å±€å…³é”®è¯ (ç”¨äºæ•´ä½“é£æ ¼å’ŒB-Rollæœç´¢)
  globalKeywords: string[];
  
  // ç›®æ ‡å—ä¼— (å½±å“è§†è§‰å¤æ‚åº¦)
  targetAudience: 'professional' | 'general' | 'beginner';
  
  // é¢„ä¼°å†…å®¹å¯†åº¦ (å½±å“è§†è§‰å…ƒç´ æ•°é‡)
  contentDensity: 'high' | 'medium' | 'low';
}
```

**LLM Prompt è¦ç‚¹**:
- åŸºäºå®Œæ•´è½¬å†™ç†è§£ä¸»é¢˜
- åˆ†æåšä¸»çš„è¡¨è¾¾é£æ ¼
- è¯†åˆ«ç›®æ ‡å—ä¼—ç‰¹å¾

---

### 4.2 Stage 2: ç»“æ„åˆ†æå±‚ â­ (æ ¸å¿ƒ)

**èŒè´£**: åˆ†ææ¯ä¸ªç‰‡æ®µçš„å†…å®¹è§’è‰²å’Œç±»å‹ï¼Œæ˜¯æ•´ä¸ª Agent çš„æ ¸å¿ƒ

**è¾“å…¥**: è½¬å†™ç‰‡æ®µ + Stage 1 ç†è§£ç»“æœ

**è¾“å‡º**:
```typescript
interface StructuredSegment {
  id: string;
  text: string;
  start_ms: number;
  end_ms: number;
  
  // ========== ç»“æ„åˆ†æç»“æœ ==========
  structure: {
    // å†…å®¹è§’è‰² (è¿™æ®µå†…å®¹åœ¨è§†é¢‘ä¸­çš„ä½œç”¨)
    role: 
      | 'hook'         // å¼€åœºé’©å­
      | 'point'        // æ ¸å¿ƒè¦ç‚¹
      | 'explanation'  // è§£é‡Šè¯´æ˜
      | 'example'      // ä¸¾ä¾‹è®ºè¯
      | 'data'         // æ•°æ®æ”¯æ’‘
      | 'transition'   // è¿‡æ¸¡è¿æ¥
      | 'summary'      // æ€»ç»“å›é¡¾
      | 'cta'          // è¡ŒåŠ¨å·å¬
      | 'filler';      // å¡«å……å†…å®¹(æ— éœ€ç‰¹æ®Šè§†è§‰)
    
    // å†…å®¹ç±»å‹ (å†³å®šç”¨ä»€ä¹ˆè§†è§‰ç»„ä»¶)
    contentType: 
      | 'title-display'     // æ ‡é¢˜å±•ç¤º â†’ å¤§å­—æ ‡é¢˜ç»„ä»¶
      | 'data-highlight'    // æ•°æ®å¼ºè°ƒ â†’ æ•°å­—åŠ¨ç”»ç»„ä»¶
      | 'keyword-emphasis'  // å…³é”®è¯å¼ºè°ƒ â†’ å…³é”®è¯å¡ç‰‡
      | 'list-item'         // åˆ—è¡¨é¡¹ â†’ ç”»å¸ƒåˆ—è¡¨ç»„ä»¶
      | 'process-step'      // æµç¨‹æ­¥éª¤ â†’ æµç¨‹å›¾ç»„ä»¶
      | 'comparison'        // å¯¹æ¯”å†…å®¹ â†’ å¯¹æ¯”è¡¨æ ¼ç»„ä»¶
      | 'story-scene'       // æ•…äº‹åœºæ™¯ â†’ B-Roll
      | 'concept-define'    // æ¦‚å¿µå®šä¹‰ â†’ å®šä¹‰å¡ç‰‡
      | 'quote'             // å¼•ç”¨è§‚ç‚¹ â†’ å¼•ç”¨æ ·å¼
      | 'direct-talk'       // ç›´æ¥å¯¹è¯ â†’ ä¿æŒå£æ’­
      | 'none';             // æ— éœ€è§†è§‰å¢å¼º
    
    // å¦‚æœæ˜¯åˆ—è¡¨é¡¹ï¼Œå½’å±ä¿¡æ¯
    listContext?: {
      listId: string;       // æ‰€å±åˆ—è¡¨ID
      itemIndex: number;    // ç¬¬å‡ é¡¹ (1-based)
      totalItems: number;   // æ€»å…±å‡ é¡¹
      itemTitle: string;    // è¯¥é¡¹çš„æ ‡é¢˜/æ‘˜è¦
    };
    
    // å¦‚æœæ˜¯æµç¨‹æ­¥éª¤
    processContext?: {
      processId: string;
      stepIndex: number;
      totalSteps: number;
      stepTitle: string;
    };
    
    // æå–çš„ç»“æ„åŒ–æ•°æ®
    extractedData?: {
      // æ•°å­—æ•°æ® (ç”¨äºæ•°å­—åŠ¨ç”»)
      numbers?: Array<{
        value: string;      // "300%", "5å€", "100ä¸‡"
        label: string;      // "å¢é•¿ç‡", "æå‡", "ç”¨æˆ·æ•°"
        trend?: 'up' | 'down' | 'neutral';
      }>;
      
      // å…³é”®è¯ (ç”¨äºå…³é”®è¯å¡ç‰‡)
      keywords?: Array<{
        word: string;
        importance: 'primary' | 'secondary';
      }>;
      
      // å¼•ç”¨ (ç”¨äºå¼•ç”¨æ ·å¼)
      quote?: {
        text: string;
        source?: string;
      };
    };
    
    // é‡è¦ç¨‹åº¦ (å½±å“è§†è§‰å¼ºåº¦)
    importance: 'critical' | 'high' | 'medium' | 'low';
    
    // æ˜¯å¦éœ€è¦B-Roll
    needsBroll: boolean;
    brollKeywords?: string[];
  };
}

// å…¨å±€ç»“æ„ä¿¡æ¯
interface GlobalStructure {
  // æ˜¯å¦æœ‰æ˜ç¡®çš„è¦ç‚¹åˆ—è¡¨ç»“æ„
  hasPointList: boolean;
  pointListCount?: number;
  
  // æ˜¯å¦æœ‰æµç¨‹/æ­¥éª¤ç»“æ„
  hasProcess: boolean;
  processStepCount?: number;
  
  // æ˜¯å¦æœ‰å¯¹æ¯”ç»“æ„
  hasComparison: boolean;
  
  // ç« èŠ‚åˆ’åˆ†
  chapters: Array<{
    title: string;
    startSegmentId: string;
    endSegmentId: string;
  }>;
}
```

**LLM Prompt è®¾è®¡è¦ç‚¹**:

```markdown
## è¯†åˆ«è§„åˆ™

### åˆ—è¡¨ç»“æ„è¯†åˆ«
- "ç¬¬ä¸€/é¦–å…ˆ/1æ˜¯..." â†’ list-item, itemIndex=1
- "ç¬¬äºŒ/ç„¶å/2æ˜¯..." â†’ list-item, itemIndex=2
- "æœ€å/ç¬¬ä¸‰..." â†’ list-item, itemIndex=n
- éœ€è¦è¿½è¸ªä¸Šä¸‹æ–‡ï¼Œç¡®å®š totalItems

### æ•°æ®è¯†åˆ«
- å‡ºç° æ•°å­—+å•ä½ â†’ data-highlight
- ä¾‹: "300%", "5å€", "100ä¸‡", "3ä¸ªæœˆ"
- æå– value å’Œ label

### å…³é”®è¯è¯†åˆ«
- "é‡è¦çš„æ˜¯/å…³é”®æ˜¯/æ ¸å¿ƒæ˜¯" â†’ keyword-emphasis
- "è®°ä½è¿™ä¸ª/åˆ’é‡ç‚¹" â†’ keyword-emphasis
- æå–åé¢çš„æ ¸å¿ƒè¯ä½œä¸º keyword

### æ•…äº‹/æ¡ˆä¾‹è¯†åˆ«
- "æ¯”å¦‚è¯´/ä¸¾ä¸ªä¾‹å­" â†’ story-scene
- "æˆ‘ä¹‹å‰/æœ‰ä¸€æ¬¡" â†’ story-scene
- è¿™ç±»å†…å®¹é€‚åˆåˆ‡B-Roll

### ç›´æ¥å¯¹è¯è¯†åˆ«
- "ä½ ä»¬è§‰å¾—å‘¢/å¯¹å§" â†’ direct-talk
- æƒ…æ„Ÿè¡¨è¾¾ã€äº’åŠ¨å¼•å¯¼ â†’ direct-talk
- è¿™ç±»å†…å®¹è¦ä¿æŒå£æ’­ç”»é¢

### é‡è¦ç¨‹åº¦åˆ¤æ–­
- critical: æ ¸å¿ƒè®ºç‚¹ã€é‡è¦æ•°æ®
- high: è¦ç‚¹å†…å®¹ã€å…³é”®æ¦‚å¿µ
- medium: è§£é‡Šè¯´æ˜ã€ä¸€èˆ¬æ¡ˆä¾‹
- low: è¿‡æ¸¡ã€å¡«å……å†…å®¹
```

---

### 4.3 Stage 3: è§†è§‰ç¼–æ’å±‚

**èŒè´£**: å°†ç»“æ„åŒ–å†…å®¹è½¬æ¢ä¸ºå…·ä½“çš„è§†è§‰ç»„ä»¶é…ç½®

**è¾“å…¥**: Stage 2 ç»“æ„åŒ–ç‰‡æ®µ

**è¾“å‡º**:
```typescript
interface VisualConfig {
  // ========== ç”»å¸ƒç»„ä»¶ (æŒç»­æ˜¾ç¤º) ==========
  canvas?: {
    type: 'point-list' | 'process-flow' | 'comparison-table' | 'concept-card';
    
    // è¦ç‚¹åˆ—è¡¨é…ç½®
    pointList?: {
      title?: string;
      items: Array<{
        id: string;
        text: string;
        revealAtMs: number;  // ä½•æ—¶æ˜¾ç¤ºè¿™ä¸€é¡¹
      }>;
      style: 'numbered' | 'bulleted' | 'checked' | 'handwritten';
      position: 'left' | 'right' | 'center';
    };
    
    // æµç¨‹å›¾é…ç½® (é€’è¿›å…³ç³»)
    processFlow?: {
      title?: string;
      steps: Array<{
        id: string;
        text: string;
        subText?: string;      // å‰¯æ ‡é¢˜/è¯´æ˜
        activateAtMs: number;
      }>;
      direction: 'horizontal' | 'vertical';
      style: 'arrow' | 'line' | 'card';  // ç®­å¤´/è¿çº¿/å¡ç‰‡
    };
    
    // å¯¹æ¯”è¡¨æ ¼é…ç½®
    comparisonTable?: {
      leftTitle: string;
      rightTitle: string;
      rows: Array<{
        left: string;
        right: string;
        revealAtMs: number;
      }>;
    };
    
    // æ¦‚å¿µå¡ç‰‡é…ç½® (å¦‚: MVPå®šä¹‰)
    conceptCard?: {
      term: string;           // "MVP"
      definition: string;     // "æœ€å°å¯æ‰§è¡Œäº§å“"
      keyPoints?: string[];   // å…³é”®è¦ç‚¹
      revealAtMs: number;
    };
  };
  
  // ========== å åŠ ç»„ä»¶ (ä¸´æ—¶æ˜¾ç¤º) ==========
  overlays: Array<{
    id: string;
    type: 
      | 'chapter-title'     // ç« èŠ‚æ ‡é¢˜
      | 'keyword-card'      // å…³é”®è¯å¡ç‰‡ (å¸¦è¾¹æ¡†é«˜äº®)
      | 'data-number'       // æ•°å­—åŠ¨ç”»
      | 'quote-block'       // å¼•ç”¨å—
      | 'highlight-box'     // é«˜äº®æ¡† (æ¡†é€‰å…³é”®è¯)
      | 'progress-indicator'// è¿›åº¦æŒ‡ç¤º (1/5)
      | 'definition-card'   // å®šä¹‰å¡ç‰‡
      | 'question-hook';    // é—®é¢˜é’©å­ (å¼€åœºé—®é¢˜)
    
    start_ms: number;
    end_ms: number;
    
    // æ ¹æ® type ä¸åŒï¼Œcontent ç»“æ„ä¸åŒ
    content: ChapterTitleContent | KeywordCardContent | DataNumberContent | ...;
    
    position: 'center' | 'top' | 'bottom' | 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';
    
    animation: {
      enter: 'fade' | 'slide-up' | 'slide-down' | 'zoom' | 'typewriter' | 'bounce' | 'draw';
      exit: 'fade' | 'slide-up' | 'slide-down' | 'zoom';
      duration_ms?: number;
    };
  }>;
  
  // ========== ä¸»è§†é¢‘é…ç½® ==========
  mainVideo: {
    // é»˜è®¤æ˜¾ç¤ºæ¨¡å¼
    defaultMode: 'fullscreen' | 'pip';
    
    // PiP é…ç½®
    pip: {
      position: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left' | 'bottom-center';
      size: 'small' | 'medium' | 'large';  // 15%, 20%, 25%
      shape: 'rectangle' | 'circle';       // çŸ©å½¢/åœ†å½¢
    };
  };
  
  // ========== å­—å¹•é…ç½® ==========
  subtitles: {
    enabled: boolean;
    style: 'modern' | 'classic' | 'minimal' | 'handwritten';
    position: 'bottom' | 'top';
    highlightKeywords: boolean;
    highlightColor?: string;  // å…³é”®è¯é«˜äº®é¢œè‰²
  };
  
  // ========== èƒŒæ™¯é…ç½® ==========
  background: {
    type: 'solid' | 'gradient' | 'paper' | 'whiteboard';
    color?: string;
    gradientColors?: string[];
    texture?: 'none' | 'paper' | 'grid' | 'dots';  // çº¹ç†
  };
}
```

**ç¼–æ’è§„åˆ™**:

```markdown
## ç»„ä»¶é€‰æ‹©è§„åˆ™

### å½“æ£€æµ‹åˆ°åˆ—è¡¨ç»“æ„æ—¶
1. åˆ›å»º canvas.pointList
2. ä¸ºæ¯ä¸ª list-item è®¾ç½® revealAtMs
3. ä¸»è§†é¢‘é»˜è®¤å˜ä¸º PiP æ¨¡å¼

### å½“æ£€æµ‹åˆ°æ•°æ®æ—¶
1. åˆ›å»º overlay: data-number
2. æ•°å­—ä½¿ç”¨æ»šåŠ¨åŠ¨ç”»
3. æŒç»­æ—¶é—´ = ç‰‡æ®µæ—¶é•¿

### å½“æ£€æµ‹åˆ°å…³é”®è¯æ—¶
1. åˆ›å»º overlay: keyword-card æˆ– highlight-box
2. ä½¿ç”¨ zoom + fade æˆ– draw åŠ¨ç”»
3. æŒç»­æ—¶é—´ 2-4 ç§’

### å½“æ£€æµ‹åˆ°æ¦‚å¿µå®šä¹‰æ—¶ (å¦‚ "ä»€ä¹ˆæ˜¯MVP")
1. åˆ›å»º canvas.conceptCard
2. æ˜¾ç¤ºæœ¯è¯­ + å®šä¹‰
3. å¯é€‰æ˜¾ç¤ºå…³é”®è¦ç‚¹

### å½“æ£€æµ‹åˆ°é—®é¢˜/é’©å­æ—¶
1. åˆ›å»º overlay: question-hook
2. æ˜¾ç¤ºé—®é¢˜æ–‡æœ¬ (çº¢è‰²å¼ºè°ƒ)
3. å¸å¼•æ³¨æ„åŠ›

### å½“æ£€æµ‹åˆ°é€’è¿›å…³ç³»æ—¶
1. åˆ›å»º canvas.processFlow
2. ç”¨ç®­å¤´è¿æ¥å„æ­¥éª¤
3. ä¾æ¬¡æ¿€æ´»æ¯ä¸ªèŠ‚ç‚¹

### å½“æ£€æµ‹åˆ°ç« èŠ‚å¼€å§‹æ—¶
1. åˆ›å»º overlay: chapter-title
2. æ˜¾ç¤ºç« èŠ‚æ ‡é¢˜
3. æŒç»­ 2-3 ç§’

## æ—¶é—´ç¼–æ’è§„åˆ™

1. åŒä¸€æ—¶é—´æœ€å¤šæ˜¾ç¤º 2 ä¸ªå åŠ ç»„ä»¶
2. ç»„ä»¶ä¹‹é—´ç•™ 500ms é—´éš”
3. å…³é”®è¯å¡ç‰‡æå‰ 200ms æ˜¾ç¤º
4. ç”»å¸ƒç»„ä»¶åœ¨å†…å®¹å¼€å§‹å‰ 500ms æ˜¾ç¤º
```

---

### 4.4 Stage 4: ç´ æåŒ¹é…å±‚

**èŒè´£**: ä¸ºè§†è§‰é…ç½®è·å–å®é™…ç´ æ

**å¤„ç†å†…å®¹**:

| ç»„ä»¶ç±»å‹ | ç´ ææ¥æº | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| B-Roll | Pexels API | å…³é”®è¯æœç´¢è§†é¢‘ |
| å›¾è¡¨ | åŠ¨æ€ç”Ÿæˆ | SVG/Canvas ç»˜åˆ¶ |
| å›¾æ ‡ | å†…ç½®å›¾æ ‡åº“ | Lucide Icons |
| èƒŒæ™¯ | é¢„è®¾ + ç”Ÿæˆ | æ¸å˜/æ¨¡ç³Šæ•ˆæœ |

**è¾“å‡º**: å®Œæ•´çš„ Remotion Config (åŒ…å«æ‰€æœ‰ç´ æ URL)

---

## 5. è§†è§‰ç»„ä»¶åº“ (Remotion å®ç°)

> æ‰€æœ‰ç»„ä»¶å‡ç”± Remotion (React + CSS) æ¸²æŸ“ï¼Œæ— éœ€å¤–éƒ¨ç´ æ

### 5.1 ç”»å¸ƒç»„ä»¶ (Canvas)

#### PointListCanvas - è¦ç‚¹åˆ—è¡¨ç”»å¸ƒ

**å‚è€ƒæ•ˆæœ** (æ‰‹å†™é£æ ¼):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ç­å°¼Bennyçš„å¤´è„‘é£æš´                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                            â”‚
â”‚  ä¸ä¼šç¼–ç¨‹çš„äººï¼Œæ­£åœ¨è¶…è¶Šç¨‹åºå‘˜                  â”‚
â”‚                                            â”‚
â”‚  Google å’Œ claude [å†…éƒ¨éƒ½åœ¨ç©]               â”‚
â”‚  æ™®é€šäººäº«å—çš„æŠ€æœ¯å¹³æƒå·¥å…·ï¼                   â”‚
â”‚                  â†‘                         â”‚
â”‚            ç»¿æ¡†é«˜äº®å…³é”®è¯                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚  å£æ’­å°çª—  â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®é¡¹**:
```typescript
interface PointListCanvasConfig {
  title?: string;                    // é¡¶éƒ¨æ ‡é¢˜
  subtitle?: string;                 // å‰¯æ ‡é¢˜
  items: Array<{
    id: string;
    text: string;
    highlight?: {                    // é«˜äº®æ¡†
      word: string;                  // è¦é«˜äº®çš„è¯
      color: 'green' | 'red' | 'yellow' | 'blue';
    };
    revealAtMs: number;
  }>;
  style: 'handwritten' | 'modern' | 'minimal';
  background: 'paper' | 'white' | 'gradient';
}
```

#### ProcessFlowCanvas - æµç¨‹/é€’è¿›å›¾ç”»å¸ƒ

**å‚è€ƒæ•ˆæœ** (ç«–å‘é€’è¿›):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  å¦‚ä½•ç”¨æœ€å°çš„æˆæœ¬                  â”‚      â”‚
â”‚  â”‚  æ¥éªŒè¯ä½ çš„äº§å“èƒ½ä¸èƒ½æ´»ä¸‹æ¥ï¼Ÿ       â”‚ â† é—®é¢˜â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                  â†“                         â”‚
â”‚          MVP:æœ€å°å¯æ‰§è¡Œäº§å“          â† æ¦‚å¿µ  â”‚
â”‚                  â†“                         â”‚
â”‚    20%çš„æŠ•å…¥å°±èƒ½å®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„é—­ç¯    â† è§£é‡Š  â”‚
â”‚                  â†“                         â”‚
â”‚    ä½ åªç”¨åš20%ï¼Œå°±èƒ½æ’¬åŠ¨80%ä»·å€¼      â† ç»“è®º  â”‚
â”‚                                            â”‚
â”‚            å¦‚ä½•ç”¨æœ€å°çš„æˆæœ¬          â† å­—å¹•  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®é¡¹**:
```typescript
interface ProcessFlowCanvasConfig {
  steps: Array<{
    id: string;
    text: string;
    type: 'question' | 'concept' | 'explanation' | 'conclusion';
    style?: {
      bordered?: boolean;        // æ˜¯å¦æœ‰è¾¹æ¡†
      color?: string;            // æ–‡å­—é¢œè‰² (é—®é¢˜é€šå¸¸çº¢è‰²)
    };
    activateAtMs: number;
  }>;
  direction: 'vertical' | 'horizontal';
  connector: 'arrow' | 'line' | 'none';  // è¿æ¥ç¬¦
  background: 'paper' | 'white' | 'cream';
}
```

#### ComparisonCanvas - å¯¹æ¯”ç”»å¸ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚     æ–¹æ¡ˆ A           â”‚      æ–¹æ¡ˆ B          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   âœ“ æˆæœ¬ä½          â”‚   âœ— æˆæœ¬é«˜           â”‚
â”‚   âœ— æ•ˆç‡ä¸€èˆ¬        â”‚   âœ“ æ•ˆç‡é«˜           â”‚
â”‚   âœ“ ä¸Šæ‰‹å¿«          â”‚   âœ— å­¦ä¹ æ›²çº¿é™¡       â”‚
â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚  å£æ’­å°çª—  â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ConceptCard - æ¦‚å¿µå®šä¹‰å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚       MVP          â”‚             â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚             â”‚
â”‚         â”‚  æœ€å°å¯æ‰§è¡Œäº§å“     â”‚             â”‚
â”‚         â”‚                    â”‚             â”‚
â”‚         â”‚  â€¢ æ ¸å¿ƒåŠŸèƒ½é—­ç¯     â”‚             â”‚
â”‚         â”‚  â€¢ 20%æŠ•å…¥         â”‚             â”‚
â”‚         â”‚  â€¢ å¿«é€ŸéªŒè¯        â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å åŠ ç»„ä»¶ (Overlays)

#### KeywordCard - å…³é”®è¯å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚  ğŸ’¡ æ ¸å¿ƒè§‚ç‚¹     â”‚        â”‚
â”‚          â”‚                 â”‚        â”‚
â”‚          â”‚  ä¸“æ³¨æ¯”åŠªåŠ›æ›´é‡è¦ â”‚        â”‚
â”‚          â”‚                 â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                     â”‚
â”‚          [å£æ’­ç”»é¢èƒŒæ™¯]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ·å¼å˜ä½“**:
- `tip`: ğŸ’¡ é»„è‰²è°ƒ
- `warning`: âš ï¸ æ©™è‰²è°ƒ
- `key`: ğŸ”‘ è“è‰²è°ƒ
- `quote`: ğŸ’¬ ç°è‰²è°ƒ

#### HighlightBox - é«˜äº®æ¡†

åœ¨æ–‡å­—ä¸Šç»˜åˆ¶è¾¹æ¡†ï¼Œå¼ºè°ƒå…³é”®è¯ (å¦‚æˆªå›¾ä¸­ "å†…éƒ¨éƒ½åœ¨ç©" çš„ç»¿æ¡†æ•ˆæœ)

```typescript
interface HighlightBoxConfig {
  text: string;              // è¦é«˜äº®çš„æ–‡å­—
  color: string;             // è¾¹æ¡†é¢œè‰²
  style: 'solid' | 'dashed' | 'handdrawn';  // è¾¹æ¡†æ ·å¼
  animation: 'draw' | 'fade' | 'pop';       // å‡ºç°åŠ¨ç”»
}
```

#### DataNumber - æ•°å­—åŠ¨ç”»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚            â”‚  300%   â”‚ â† æ•°å­—æ»šåŠ¨   â”‚
â”‚            â”‚  å¢é•¿ç‡  â”‚              â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â†‘ ä¸Šå‡ç®­å¤´              â”‚
â”‚                                     â”‚
â”‚          [å£æ’­ç”»é¢èƒŒæ™¯]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠ¨ç”»æ•ˆæœ**:
- æ•°å­—ä» 0 æ»šåŠ¨åˆ°ç›®æ ‡å€¼
- å¯é…ç½®ä¸Šå‡/ä¸‹é™ç®­å¤´
- æ”¯æŒå•ä½(%, å€, ä¸‡ç­‰)

```typescript
interface DataNumberConfig {
  value: string;           // "300%", "20%", "80%"
  label: string;           // "å¢é•¿ç‡", "æŠ•å…¥", "ä»·å€¼"
  trend?: 'up' | 'down' | 'neutral';
  color?: string;
  size: 'small' | 'medium' | 'large';
}
```

#### QuestionHook - é—®é¢˜é’©å­

å¼€åœºå¸å¼•æ³¨æ„åŠ›çš„é—®é¢˜å±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚   å¦‚ä½•ç”¨æœ€å°çš„æˆæœ¬        â”‚      â”‚
â”‚    â”‚   æ¥éªŒè¯ä½ çš„äº§å“          â”‚      â”‚
â”‚    â”‚   èƒ½ä¸èƒ½æ´»ä¸‹æ¥ï¼Ÿ          â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚  [æ–‡å­—é¢œè‰²: çº¢è‰², è¾¹æ¡†: åœ†è§’çŸ©å½¢]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ChapterTitle - ç« èŠ‚æ ‡é¢˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚                                     â”‚
â”‚         ç¬¬ä¸€éƒ¨åˆ†                     â”‚
â”‚         â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚         ä»€ä¹ˆæ˜¯ç•ªèŒ„å·¥ä½œæ³•              â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚          [æ·¡å…¥æ·¡å‡ºåŠ¨ç”»]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ProgressIndicator - è¿›åº¦æŒ‡ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  2 / 5  â”‚ â† å½“å‰ç¬¬2ç‚¹ï¼Œå…±5ç‚¹      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                     â”‚
â”‚          [å£æ’­ç”»é¢]                  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### QuoteBlock - å¼•ç”¨å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  "                      â”‚      â”‚
â”‚    â”‚   ç®€å•çš„äº‹æƒ…é‡å¤åšï¼Œ      â”‚      â”‚
â”‚    â”‚   ä½ å°±æ˜¯ä¸“å®¶ã€‚           â”‚      â”‚
â”‚    â”‚                   "     â”‚      â”‚
â”‚    â”‚           â€”â€” ç¨»ç››å’Œå¤«    â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å­—å¹•ç»„ä»¶

#### AnimatedSubtitle - åŠ¨ç”»å­—å¹•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚          [è§†é¢‘ç”»é¢]                  â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  å¦‚ä½•ç”¨[æœ€å°]çš„æˆæœ¬       â”‚ â† å…³é”®è¯é«˜äº®
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®é¡¹**:
```typescript
interface SubtitleConfig {
  text: string;
  highlightWords?: string[];   // è¦é«˜äº®çš„è¯
  highlightColor?: string;
  style: 'modern' | 'handwritten' | 'minimal';
  position: 'bottom' | 'top';
  background?: 'blur' | 'solid' | 'none';
}
```

---

## 6. åŸºäºå¸‚åœºè°ƒç ”çš„æ¨¡ç‰ˆç³»ç»Ÿ

> **æ ¸å¿ƒç†å¿µ**: ä¸å†å‡­ç©ºè®¾è®¡ï¼Œè€Œæ˜¯åŸºäºå¸‚åœºä¸Šæœ€æˆåŠŸçš„çŸ¥è¯†åšä¸»è§†é¢‘å½¢æ€ï¼ˆBenchmarkï¼‰æ¥å®šä¹‰æ¨¡ç‰ˆã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¤åˆ»è¿™äº›ç»è¿‡å¸‚åœºéªŒè¯çš„æˆåŠŸæ¨¡å¼ã€‚

### 6.1 å…­å¤§æ ¸å¿ƒæ¨¡ç‰ˆ (Archetypes)

åŸºäºå¯¹ CapCutã€YouTube å¤´éƒ¨åšä¸»åŠç«å“è°ƒç ”ï¼Œæˆ‘ä»¬å®šä¹‰äº†çŸ¥è¯†ç±»è§†é¢‘çš„ 6 ç§æ ‡å‡†å½¢æ€ï¼š

| æ¨¡ç‰ˆID | åç§° | æ ¸å¿ƒç‰¹å¾ | æ ‡æ†æ¡ˆä¾‹ (Benchmark) |
|---|---|---|---|
| `mixed-media` | **æ··åˆåª’ä½“** | **(P0)** å£æ’­ + B-Roll + æ•°æ®å›¾è¡¨é«˜é¢‘åˆ‡æ¢ï¼Œä¿¡æ¯å¯†åº¦é«˜ | Ali Abdaal, MKBHD |
| `talking-head` | **å£æ’­ä¸»å¯¼** | **(P0)** äººç‰©ä¸ºä¸»ï¼Œå¼ºè°ƒæƒ…ç»ªå’Œè§‚ç‚¹ï¼Œè¾…ä»¥å…³é”®å¸§å­—å¹• | Casey Neistat, ææ°¸ä¹è€å¸ˆ |
| `whiteboard` | **ç™½æ¿è®²è§£** | **(P1)** æç®€ç”»å¸ƒ + æ‰‹ç»˜æ¨æ¼”ï¼Œé€‚åˆé€»è¾‘è§£æ | 3Blue1Brown, ç­å°¼Benny |
| `screencast` | **å±å½•æ•™ç¨‹** | **(P2)** è½¯ä»¶ç•Œé¢å½•åˆ¶ + é¼ æ ‡é«˜äº® + æ­¥éª¤æŒ‡å¼• | Fireship, å„ç§ç¼–ç¨‹æ•™ç¨‹ |
| `videographic` | **æ•°æ®å¯è§†åŒ–** | æ•°æ®å›¾è¡¨åŠ¨ç”» + æ— äººå£°/é…éŸ³ï¼Œé€‚åˆæ–°é—»/ç§‘æ™® | Vox, è´¢æ–°è§†é¢‘ |
| `slideshow` | **å¹»ç¯ç‰‡æ¼”ç¤º** | ç»“æ„åŒ–é¡µé¢åˆ‡æ¢ï¼Œé€‚åˆæ­£å¼åŸ¹è®­ | TED Talks, å¾—åˆ°App |

### 6.2 æ¨¡ç‰ˆè¯¦æƒ…ä¸è§†è§‰è§„èŒƒ

#### (1) Mixed Media (æ··åˆåª’ä½“) - çŸ¥è¯†åšä¸»é¦–é€‰
*   **ç”»é¢æ„æˆ**: 30% å£æ’­ (å»ºç«‹è¿æ¥) + 40% B-Roll (å…·è±¡åŒ–) + 30% å›¾å½¢/å›¾è¡¨ (æŠ½è±¡åŒ–)
*   **è§†è§‰èŠ‚å¥**: æå¿«ï¼Œæ¯ 3-5 ç§’åˆ‡æ¢ä¸€æ¬¡è§†è§‰å…ƒç´ 
*   **å…³é”®ç»„ä»¶**: åˆ†å±å¯¹æ¯”ã€æ•°æ®æ‚¬æµ®çª—ã€å¼•ç”¨å¡ç‰‡
*   **é€‚ç”¨åœºæ™¯**: å¤æ‚çš„çŸ¥è¯†è®²è§£ã€äº§å“æµ‹è¯„ã€æ·±åº¦åˆ†æ

#### (2) Talking Head (å£æ’­ä¸»å¯¼)
*   **ç”»é¢æ„æˆ**: 90% äººç‰©ç”»é¢ (å…¨å±/è¿‘æ™¯åˆ‡æ¢) + 10% å¼ºè°ƒæ€§å­—å¹•
*   **è§†è§‰èŠ‚å¥**: è¾ƒæ…¢ï¼Œä¾èµ–åšä¸»çš„è¡¨æ¼”å’Œè¯­è°ƒ
*   **å…³é”®ç»„ä»¶**: åŠ¨æ€å­—å¹• (Word-by-word highlight)ã€è¡¨æƒ…åŒ…/è´´çº¸ã€å…³é”®è§‚ç‚¹å¼¹å‡ºå¡
*   **é€‚ç”¨åœºæ™¯**: ä¸ªäººè§‚ç‚¹è¡¨è¾¾ã€æƒ…æ„Ÿå…±é¸£ã€æ•…äº‹è®²è¿°

### 6.3 LangChain é›†æˆç­–ç•¥ (æ ‡æ†é©±åŠ¨)

å¦‚ä½•åœ¨ LangChain æµç¨‹ä¸­ä½¿ç”¨è¿™äº›æ¨¡ç‰ˆï¼Ÿæˆ‘ä»¬å°†é‡‡ç”¨ **"æ ‡æ†é©±åŠ¨ (Benchmark-Driven)"** çš„ Prompt ç­–ç•¥ã€‚

#### ç¬¬ä¸€æ­¥ï¼šæ¨¡ç‰ˆè·¯ç”± (Template Router Chain)
ä½¿ç”¨ LLM åˆ†æè„šæœ¬ç‰¹å¾ï¼ŒåŒ¹é…æœ€ä½³æ¨¡ç‰ˆã€‚

```python
ROUTER_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§†é¢‘å¯¼æ¼”ã€‚åˆ†æç”¨æˆ·çš„è„šæœ¬ï¼Œä»ä»¥ä¸‹æ ‡å‡†æ¨¡ç‰ˆä¸­é€‰æ‹©æœ€åˆé€‚çš„ä¸€ä¸ªï¼š

1. mixed-media: è„šæœ¬åŒ…å«å¤§é‡ä¸¾ä¾‹ã€æ•°æ®ã€åœºæ™¯æè¿°ï¼Œéœ€è¦ä¸°å¯Œçš„è§†è§‰ç´ æã€‚
2. talking-head: è„šæœ¬ä¸»è¦æ˜¯ä¸ªäººè§‚ç‚¹ã€æƒ…æ„ŸæŠ’å‘ï¼Œå¼ºè°ƒè®²è¿°è€…çš„ä¸ªäººé­…åŠ›ã€‚
3. whiteboard: è„šæœ¬åœ¨è§£é‡Šä¸€ä¸ªå¤æ‚çš„æ¦‚å¿µã€é€»è¾‘æ¨æ¼”æˆ–æ•°å­¦æ¨¡å‹ã€‚
...

è¾“å‡º: æ¨¡ç‰ˆID åŠ é€‰æ‹©ç†ç”±
"""
```

#### ç¬¬äºŒæ­¥ï¼šåŸºäºæ ‡æ†çš„ Few-Shot Prompting (æ ¸å¿ƒ)
åœ¨ç”Ÿæˆè§†è§‰é…ç½®æ—¶ï¼Œ**ä¸åªè¦å‘Šè¯‰ Agent è§„åˆ™ï¼Œæ›´è¦ç»™å®ƒçœ‹"ä»€ä¹ˆæ˜¯å¥½çš„"**ã€‚æˆ‘ä»¬ä¼šæŠŠæ ‡æ†è§†é¢‘çš„é…ç½®ç‰‡æ®µä½œä¸º Few-Shot Examples æ”¾å…¥ Promptã€‚

**VisualChain Prompt è®¾è®¡**:

```markdown
æ­¤æ—¶çš„ Agent è§’è‰²ï¼šä½ æ˜¯ä¸€åç²¾é€š [Selected_Template] é£æ ¼çš„å‰ªè¾‘å¸ˆã€‚

ä½ çš„ç›®æ ‡æ˜¯æ¨¡ä»¿ [Benchmark_Creator] çš„å‰ªè¾‘é£æ ¼ã€‚

## é£æ ¼æŒ‡å— ([Selected_Template])
- [Mixed-Media]: å¿…é¡»ä¿è¯ç”»é¢æ¯ 5 ç§’æœ‰å˜åŒ–ã€‚æåˆ°å…·ä½“åè¯æ—¶å¿…é¡»é… B-Rollã€‚æåˆ°æ•°æ®æ—¶å¿…é¡»é…å›¾è¡¨ã€‚
- [Talking-Head]: ä¿æŒé•œå¤´èšç„¦äººç‰©ã€‚ä»…åœ¨å¼ºè°ƒæ ¸å¿ƒè§‚ç‚¹æ—¶æ‰ä½¿ç”¨å åŠ ç»„ä»¶ã€‚

## æ ‡æ†èŒƒä¾‹ (Few-Shot Examples)

**èŒƒä¾‹ 1 (Mixed-Media é£æ ¼ - æ¨¡ä»¿ Ali Abdaal):**
Input Text: "æ ¹æ® 2023 å¹´çš„æ•°æ®æ˜¾ç¤ºï¼Œé˜…è¯»çº¸è´¨ä¹¦çš„äººæ•°å¢é•¿äº† 15%ã€‚"
Reasoning: è¿™æ˜¯ä¸€ä¸ªæ•°æ®å±•ç¤ºç‚¹ï¼Œä¸åº”è¯¥åªç”¨å£æ’­ã€‚åº”è¯¥ç”¨æ•°æ®å›¾è¡¨ç»„ä»¶ã€‚
Visual Config:
{
  "type": "overlay",
  "component": "DataHighlight",
  "props": { "value": "15%", "label": "å¢é•¿ç‡", "trend": "up" },
  "video_track": "b-roll(reading_book.mp4)"
}

**èŒƒä¾‹ 2 (Talking-Head é£æ ¼ - æ¨¡ä»¿ Casey):**
Input Text: "ä½†æˆ‘è®¤ä¸ºï¼Œè¿™ä¸ä»…ä»…æ˜¯æ•°æ®çš„é—®é¢˜ï¼Œæ›´æ˜¯ä¸€ç§ç”Ÿæ´»æ€åº¦ã€‚"
Reasoning: è¿™æ˜¯æƒ…æ„Ÿè¡¨è¾¾ï¼Œéœ€è¦è§‚ä¼—çœ‹æ¸…è¡¨æƒ…ã€‚ä¿æŒå…¨å±å£æ’­ï¼Œç”¨é•œå¤´æ¨è¿›å¼ºè°ƒæƒ…ç»ªã€‚
Visual Config:
{
  "type": "camera_movement",
  "action": "zoom_in",
  "duration": 2000,
  "video_track": "main_camera"
}

## ä½ çš„ä»»åŠ¡
åŸºäºä¸Šè¿°é£æ ¼æŒ‡å—å’ŒèŒƒä¾‹ï¼Œä¸ºä»¥ä¸‹è„šæœ¬ç”Ÿæˆè§†è§‰é…ç½®...
```

### 6.4 æ¨¡ç‰ˆåº“çš„ç»´æŠ¤ (Template Registry)
æˆ‘ä»¬åœ¨ä»£ç ä¸­ç»´æŠ¤ä¸€ä¸ª `TemplateRegistry`ï¼Œä¸ä»…å­˜å‚¨ CSS æ ·å¼ï¼Œæ›´å­˜å‚¨ **"Prompt Context"**ã€‚

```python
# backend/app/services/remotion_agent/templates/registry.py

TEMPLATES = {
  "mixed-media": {
    "style": { ... }, // Remotion visual settings
    "llm_context": {
       "system_instruction": "You are an editor mimicking Ali Abdaal style...",
       "few_shot_examples": [ ... ], // è¿™ç§æ¨¡ç‰ˆä¸‹çš„ä¼˜ç§€èŒƒä¾‹
       "constraints": ["No static screens > 5s", "Always visualize numbers"]
    }
  }
}
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨æ•™ Agent "æ€ä¹ˆå†™ JSON"ï¼Œè€Œæ˜¯åœ¨æ•™å®ƒ **"æ€ä¹ˆåƒä¸€ä¸ªé¡¶çº§åšä¸»ä¸€æ ·æ€è€ƒ"**ã€‚

### 6.5 RAG + çŸ¥è¯†åº“æ¶æ„ (æ ¸å¿ƒ)

> **å…³é”®æ´å¯Ÿ**: Few-Shot Examples ä¸åº”è¯¥ç¡¬ç¼–ç ï¼Œè€Œåº”è¯¥ä»**æ ‡æ†è§†é¢‘çŸ¥è¯†åº“**ä¸­åŠ¨æ€æ£€ç´¢ã€‚

#### 6.5.1 ä¸ºä»€ä¹ˆéœ€è¦çŸ¥è¯†åº“ï¼Ÿ

| é—®é¢˜ | ç¡¬ç¼–ç  Prompt | RAG + çŸ¥è¯†åº“ |
|-----|--------------|-------------|
| èŒƒä¾‹æ•°é‡ | åªèƒ½æ”¾ 2-3 ä¸ª | å¯å­˜å‚¨ 1000+ ä¸ªæ ‡æ†ç‰‡æ®µ |
| ç›¸å…³æ€§ | å›ºå®šèŒƒä¾‹ï¼Œå¯èƒ½ä¸åŒ¹é…ç”¨æˆ·å†…å®¹ | åŠ¨æ€æ£€ç´¢æœ€ç›¸ä¼¼çš„èŒƒä¾‹ |
| å¯ç»´æŠ¤æ€§ | æ”¹ Prompt éœ€è¦æ”¹ä»£ç  | åªéœ€æ›´æ–°çŸ¥è¯†åº“ |
| å¯æ‰©å±•æ€§ | æ–°æ¨¡ç‰ˆéœ€é‡å†™ Prompt | åªéœ€æ·»åŠ æ–°çš„æ ‡æ†æ•°æ® |

#### 6.5.2 çŸ¥è¯†åº“çš„æ•°æ®ç»“æ„

```python
# æ ‡æ†ç‰‡æ®µ (Benchmark Segment)
class BenchmarkSegment:
    id: str
    template_id: str                    # æ‰€å±æ¨¡ç‰ˆ (mixed-media, talking-head, ...)
    benchmark_creator: str              # æ ‡æ†åšä¸» (Ali Abdaal, Casey, ...)
    
    # è¾“å…¥
    script_text: str                    # åŸå§‹è„šæœ¬æ–‡æœ¬
    script_embedding: List[float]       # è„šæœ¬çš„å‘é‡è¡¨ç¤º (ç”¨äºæ£€ç´¢)
    
    # ä¸Šä¸‹æ–‡
    content_type: str                   # å†…å®¹ç±»å‹ (data, opinion, story, ...)
    scene_context: str                  # åœºæ™¯æè¿° (å¼€åœº/ä¸­æ®µ/ç»“å°¾)
    
    # è¾“å‡º (æ ‡æ†ç­”æ¡ˆ)
    visual_config: dict                 # æ ‡å‡†çš„ VisualConfig JSON
    reasoning: str                      # ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ (Chain-of-Thought)
    
    # å…ƒæ•°æ®
    source_video_url: str               # åŸè§†é¢‘é“¾æ¥ (ç”¨äºäººå·¥å®¡æ ¸)
    timestamp_ms: int                   # åœ¨åŸè§†é¢‘ä¸­çš„æ—¶é—´ç‚¹
```

#### 6.5.3 Agent Workflow with RAG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Remotion Agent Workflow (RAG-Enhanced)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç”¨æˆ·è„šæœ¬ç‰‡æ®µ                                                            â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  1. Embedding   â”‚  å°†è„šæœ¬ç‰‡æ®µè½¬ä¸ºå‘é‡                                  â”‚
â”‚  â”‚  (text-embed)   â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚           â”‚                                                             â”‚
â”‚           â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. å‘é‡æ£€ç´¢     â”‚â”€â”€â”€â”€â–¶â”‚  æ ‡æ†è§†é¢‘çŸ¥è¯†åº“ (Vector Store)           â”‚   â”‚
â”‚  â”‚  (Similarity)   â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚ Ali Abdaal ç‰‡æ®µ #127            â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Script: "ç ”ç©¶è¡¨æ˜ï¼Œæ¯å¤©é˜…è¯»..."   â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Config: { overlay: DataChart }  â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Reasoning: "æ•°æ®éœ€è¦å¯è§†åŒ–..."   â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚           â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Casey ç‰‡æ®µ #89                  â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Script: "ä½†æˆ‘è®¤ä¸ºçœŸæ­£é‡è¦çš„æ˜¯..." â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Config: { camera: zoom_in }     â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â”‚ Reasoning: "æƒ…æ„Ÿè¡¨è¾¾éœ€è¦ç‰¹å†™..." â”‚   â”‚   â”‚
â”‚           â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                                             â”‚
â”‚           â–¼  Top-K ç›¸ä¼¼ç‰‡æ®µ                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  3. Prompt ç»„è£…  â”‚  å°†æ£€ç´¢åˆ°çš„æ ‡æ†ç‰‡æ®µä½œä¸º Few-Shot Examples          â”‚
â”‚  â”‚  (Few-Shot)     â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚           â”‚                                                             â”‚
â”‚           â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  4. LLM ç”Ÿæˆ     â”‚  åŸºäºæ ‡æ†èŒƒä¾‹ï¼Œç”Ÿæˆå½“å‰ç‰‡æ®µçš„ VisualConfig          â”‚
â”‚  â”‚  (GPT-4/Claude) â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚           â”‚                                                             â”‚
â”‚           â–¼                                                             â”‚
â”‚      VisualConfig                                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.5.4 LangChain å®ç°ä»£ç 

```python
# backend/app/services/remotion_agent/rag_visual_chain.py

from langchain.vectorstores import Chroma
from langchain.embeddings import OpenAIEmbeddings
from langchain.prompts import ChatPromptTemplate
from langchain.chat_models import ChatOpenAI

class RAGVisualChain:
    def __init__(self):
        # 1. åˆå§‹åŒ–å‘é‡æ•°æ®åº“ (å­˜å‚¨æ ‡æ†ç‰‡æ®µ)
        self.embeddings = OpenAIEmbeddings()
        self.vectorstore = Chroma(
            collection_name="benchmark_segments",
            embedding_function=self.embeddings,
            persist_directory="./data/benchmark_db"
        )
        
        # 2. åˆå§‹åŒ– LLM
        self.llm = ChatOpenAI(model="gpt-4", temperature=0.3)
    
    def generate_visual_config(
        self, 
        script_segment: str, 
        template_id: str,
        k: int = 3
    ) -> dict:
        """
        åŸºäº RAG ç”Ÿæˆè§†è§‰é…ç½®
        
        Args:
            script_segment: ç”¨æˆ·çš„è„šæœ¬ç‰‡æ®µ
            template_id: é€‰å®šçš„æ¨¡ç‰ˆ ID
            k: æ£€ç´¢çš„æ ‡æ†ç‰‡æ®µæ•°é‡
        """
        
        # Step 1: æ£€ç´¢ç›¸ä¼¼çš„æ ‡æ†ç‰‡æ®µ
        similar_segments = self.vectorstore.similarity_search(
            query=script_segment,
            k=k,
            filter={"template_id": template_id}  # åªæ£€ç´¢åŒæ¨¡ç‰ˆçš„æ ‡æ†
        )
        
        # Step 2: æ„å»º Few-Shot Prompt
        few_shot_examples = self._format_examples(similar_segments)
        
        prompt = ChatPromptTemplate.from_messages([
            ("system", SYSTEM_PROMPT.format(template_id=template_id)),
            ("human", FEW_SHOT_PROMPT.format(
                examples=few_shot_examples,
                user_script=script_segment
            ))
        ])
        
        # Step 3: è°ƒç”¨ LLM ç”Ÿæˆ
        chain = prompt | self.llm | JsonOutputParser()
        return chain.invoke({})
    
    def _format_examples(self, segments) -> str:
        """å°†æ£€ç´¢åˆ°çš„æ ‡æ†ç‰‡æ®µæ ¼å¼åŒ–ä¸º Few-Shot æ ¼å¼"""
        examples = []
        for seg in segments:
            examples.append(f"""
**æ ‡æ†èŒƒä¾‹ (æ¥è‡ª {seg.metadata['benchmark_creator']}):**
è„šæœ¬: "{seg.page_content}"
æ€è€ƒè¿‡ç¨‹: {seg.metadata['reasoning']}
è§†è§‰é…ç½®:
```json
{seg.metadata['visual_config']}
```
""")
        return "\n---\n".join(examples)


# Prompt æ¨¡æ¿
SYSTEM_PROMPT = """
ä½ æ˜¯ä¸€åä¸“ä¸šçš„è§†é¢‘å‰ªè¾‘å¸ˆï¼Œç²¾é€š {template_id} é£æ ¼çš„è§†è§‰ç¼–æ’ã€‚
ä½ çš„ä»»åŠ¡æ˜¯ä¸ºç”¨æˆ·çš„è„šæœ¬ç‰‡æ®µç”Ÿæˆæœ€ä½³çš„è§†è§‰é…ç½® (VisualConfig)ã€‚

åœ¨ç”Ÿæˆé…ç½®å‰ï¼Œä½ å¿…é¡»ï¼š
1. åˆ†æè„šæœ¬çš„å†…å®¹ç±»å‹ (æ•°æ®/è§‚ç‚¹/æ•…äº‹/...)
2. å‚è€ƒæ ‡æ†èŒƒä¾‹çš„è®¾è®¡æ€è·¯
3. è¾“å‡ºä½ çš„æ€è€ƒè¿‡ç¨‹ (reasoning)
4. ç”Ÿæˆç¬¦åˆæ ¼å¼çš„ JSON é…ç½®
"""

FEW_SHOT_PROMPT = """
## æ ‡æ†èŒƒä¾‹ (è¯·æ¨¡ä»¿è¿™äº›ä¼˜ç§€æ¡ˆä¾‹çš„è®¾è®¡æ€è·¯)

{examples}

---

## ä½ çš„ä»»åŠ¡

è¯·ä¸ºä»¥ä¸‹è„šæœ¬ç‰‡æ®µç”Ÿæˆè§†è§‰é…ç½®ï¼š

è„šæœ¬: "{user_script}"

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š
1. å†…å®¹åˆ†æ: (è¿™æ®µå†…å®¹çš„ç±»å‹å’Œç‰¹ç‚¹)
2. è®¾è®¡æ€è·¯: (ä¸ºä»€ä¹ˆé€‰æ‹©è¿™æ ·çš„è§†è§‰å‘ˆç°)
3. è§†è§‰é…ç½®: (JSON æ ¼å¼çš„ VisualConfig)
"""
```

#### 6.5.5 çŸ¥è¯†åº“å¦‚ä½•å»ºè®¾ï¼Ÿ

**æ–¹å¼ä¸€ï¼šäººå·¥æ ‡æ³¨ (é«˜è´¨é‡)**
1. é€‰å– 10 ä¸ªæ ‡æ†åšä¸»çš„ 100 ä¸ªè§†é¢‘
2. äººå·¥æ‹†è§£æ¯ä¸ªè§†é¢‘çš„å…³é”®ç‰‡æ®µ
3. è®°å½•æ¯ä¸ªç‰‡æ®µçš„: è„šæœ¬ + è§†è§‰é…ç½® + è®¾è®¡ç†ç”±
4. å½•å…¥çŸ¥è¯†åº“

**æ–¹å¼äºŒï¼šAI è¾…åŠ©æ ‡æ³¨ (è§„æ¨¡åŒ–)**
1. ç”¨ Whisper æå–æ ‡æ†è§†é¢‘çš„è„šæœ¬
2. ç”¨è§†è§‰åˆ†ææ¨¡å‹ (GPT-4V) è¯†åˆ«ç”»é¢å…ƒç´ 
3. äººå·¥å®¡æ ¸ AI æ ‡æ³¨ç»“æœ
4. æ‰¹é‡å½•å…¥çŸ¥è¯†åº“

**æ–¹å¼ä¸‰ï¼šç”¨æˆ·åé¦ˆé—­ç¯ (æŒç»­ä¼˜åŒ–)**
1. ç”¨æˆ·ä½¿ç”¨åï¼Œå¯¹ç”Ÿæˆç»“æœæ‰“åˆ†
2. é«˜åˆ†ç»“æœè‡ªåŠ¨è¿›å…¥å€™é€‰çŸ¥è¯†åº“
3. äººå·¥å®¡æ ¸åæˆä¸ºæ–°çš„æ ‡æ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¥è¯†åº“å»ºè®¾è·¯å¾„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Phase 1 (å†·å¯åŠ¨)                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   äººå·¥æ ‡æ³¨ 50 ä¸ªæ ‡æ†ç‰‡æ®µ (æ¯æ¨¡ç‰ˆ 10 ä¸ª)                           â”‚
â”‚   ç›®æ ‡: éªŒè¯ RAG æ¶æ„å¯è¡Œæ€§                                       â”‚
â”‚                                                                 â”‚
â”‚   Phase 2 (è§„æ¨¡åŒ–)                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   AI è¾…åŠ©æ ‡æ³¨ 500+ ç‰‡æ®µ                                          â”‚
â”‚   ç›®æ ‡: è¦†ç›–å¸¸è§å†…å®¹ç±»å‹                                          â”‚
â”‚                                                                 â”‚
â”‚   Phase 3 (è‡ªæˆ‘è¿›åŒ–)                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   ç”¨æˆ·åé¦ˆé©±åŠ¨çš„çŸ¥è¯†åº“æ›´æ–°                                        â”‚
â”‚   ç›®æ ‡: æŒç»­æå‡ç”Ÿæˆè´¨é‡                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.5.6 æŠ€æœ¯æ ˆé€‰æ‹©

| ç»„ä»¶ | æ¨èæ–¹æ¡ˆ | å¤‡é€‰æ–¹æ¡ˆ |
|-----|---------|---------|
| å‘é‡æ•°æ®åº“ | **Chroma** (è½»é‡çº§) | Pinecone, Weaviate |
| Embedding æ¨¡å‹ | **text-embedding-3-small** | BGE-M3 (å¼€æº) |
| LLM | **GPT-4** | Claude 3.5, DeepSeek |
| æ¡†æ¶ | **LangChain** | LlamaIndex |

### 6.6 æ¨¡ç‰ˆé€‰æ‹©å»ºè®®

---

## 7. æˆç†Ÿ Agent å·¥ä½œæµæ¶æ„ (åŸºäºä¸šç•Œæœ€ä½³å®è·µ)

> **æ ¸å¿ƒç†å¿µ**: åŸºäº LangGraphã€CrewAIã€Anthropic Agent æ¶æ„æŒ‡å—çš„è°ƒç ”ï¼Œè®¾è®¡ä¸€å¥—**ç”Ÿäº§çº§**çš„ Agent Workflowï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„ Prompt Chainingã€‚

### 7.1 Agent æ¶æ„è°ƒç ”æ€»ç»“

#### 7.1.1 ä¸»æµæ¡†æ¶å¯¹æ¯”

| æ¡†æ¶/èŒƒå¼ | æ ¸å¿ƒç†å¿µ | å…³é”®ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ |
|----------|---------|---------|---------|
| **ReAct** | Reasoning + Acting äº¤æ›¿ | æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯ | éœ€è¦å·¥å…·è°ƒç”¨çš„ä»»åŠ¡ |
| **Plan-and-Execute** | å…ˆè§„åˆ’åæ‰§è¡Œ | Planner + Executor åˆ†ç¦» | å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ |
| **LangGraph** | Agent as State Machine | çŠ¶æ€å›¾ã€èŠ‚ç‚¹ã€è¾¹ã€æ£€æŸ¥ç‚¹ | éœ€è¦å¤æ‚æµç¨‹æ§åˆ¶ |
| **CrewAI** | Flows + Crews | æµç¨‹ç¼–æ’ + å¤šè§’è‰²åä½œ | éœ€è¦å¤šä¸“å®¶åä½œ |
| **Anthropic æ¨¡å¼** | ä»ç®€å•åˆ°å¤æ‚é€æ­¥å‡çº§ | Workflow vs Agent åŒºåˆ† | ç”Ÿäº§çº§å¯é æ€§ |

#### 7.1.2 Anthropic "Building Effective Agents" æ ¸å¿ƒæ¨¡å¼

Anthropic æ€»ç»“äº† 5 ç§**å·¥ä½œæµ (Workflow)** æ¨¡å¼å’Œ 1 ç§**Agent** æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Anthropic Agent æ¶æ„å¤æ‚åº¦é‡‘å­—å¡”                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                          â”‚  Agent    â”‚  â† æœ€é«˜å¤æ‚åº¦                    â”‚
â”‚                          â”‚ (è‡ªä¸»å¾ªç¯) â”‚    LLM å®Œå…¨æ§åˆ¶æµç¨‹               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚  Evaluator-Optimizer  â”‚  â† è¿­ä»£ä¼˜åŒ–                 â”‚
â”‚                    â”‚   (è¯„ä¼°-ä¼˜åŒ–å¾ªç¯)       â”‚    ç”Ÿæˆâ†’è¯„ä¼°â†’æ”¹è¿›            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚     Orchestrator-Workers          â”‚  â† åŠ¨æ€åˆ†è§£            â”‚
â”‚              â”‚    (ç¼–æ’è€…-å·¥äºº)                    â”‚    ä¸­å¤®è°ƒåº¦+å¹¶è¡Œæ‰§è¡Œ    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚        â”‚              Parallelization                  â”‚  â† å¹¶è¡Œå¤„ç†      â”‚
â”‚        â”‚         (åˆ†ç‰‡/æŠ•ç¥¨å¹¶è¡Œ)                         â”‚    å¤šè·¯å¹¶è¡Œ+èšåˆ  â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚                    Routing                            â”‚  â† è·¯ç”±åˆ†å‘   â”‚
â”‚    â”‚              (è·¯ç”±åˆ°ä¸“ä¸šå¤„ç†å™¨)                          â”‚    åˆ†ç±»+ä¸“ä¸šåŒ– â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                    Prompt Chaining                        â”‚  â† æœ€ç®€å•  â”‚
â”‚  â”‚              (æç¤ºé“¾: Aâ†’Bâ†’C ä¸²è¡Œ)                           â”‚    å›ºå®šæµç¨‹ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                         â”‚
â”‚  åŸåˆ™: ä»ä¸‹å¾€ä¸Šé€‰æ‹©ï¼Œåªæœ‰å½“ç®€å•æ–¹æ¡ˆä¸è¶³æ—¶æ‰å¢åŠ å¤æ‚åº¦                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Remotion Agent é‡‡ç”¨çš„æ¶æ„: Orchestrator-Workers + RAG

åŸºäºè§†é¢‘è§†è§‰ç¼–æ’çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬é‡‡ç”¨ **Orchestrator-Workers** æ¨¡å¼ï¼Œç»“åˆ **RAG çŸ¥è¯†æ£€ç´¢**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Remotion Agent ç”Ÿäº§çº§æ¶æ„ (LangGraph + RAG)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ORCHESTRATOR (ç¼–æ’å™¨)                            â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   èŒè´£:                                                              â”‚   â”‚
â”‚   â”‚   1. æ¥æ”¶ç”¨æˆ·è„šæœ¬                                                    â”‚   â”‚
â”‚   â”‚   2. å†³å®šä»»åŠ¡åˆ†è§£ç­–ç•¥                                                 â”‚   â”‚
â”‚   â”‚   3. è°ƒåº¦ Worker Agents                                              â”‚   â”‚
â”‚   â”‚   4. èšåˆç»“æœã€å¤„ç†å†²çª                                               â”‚   â”‚
â”‚   â”‚   5. åˆ¤æ–­æ˜¯å¦éœ€è¦è¿­ä»£ä¼˜åŒ–                                             â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   LangGraph State:                                                   â”‚   â”‚
â”‚   â”‚   {                                                                  â”‚   â”‚
â”‚   â”‚     script: str,                                                     â”‚   â”‚
â”‚   â”‚     segments: List[Segment],                                         â”‚   â”‚
â”‚   â”‚     current_stage: "routing" | "analysis" | "visual" | "review",     â”‚   â”‚
â”‚   â”‚     worker_results: Dict[str, Any],                                  â”‚   â”‚
â”‚   â”‚     iteration_count: int,                                            â”‚   â”‚
â”‚   â”‚     final_config: VisualConfig | None                                â”‚   â”‚
â”‚   â”‚   }                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚          â”‚                         â”‚                         â”‚               â”‚
â”‚          â–¼                         â–¼                         â–¼               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚   WORKER 1   â”‚          â”‚   WORKER 2   â”‚          â”‚   WORKER 3   â”‚         â”‚
â”‚   â”‚   Template   â”‚          â”‚   Content    â”‚          â”‚   Visual     â”‚         â”‚
â”‚   â”‚   Router     â”‚          â”‚   Analyzer   â”‚          â”‚   Designer   â”‚         â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚   â”‚ èŒè´£:        â”‚          â”‚ èŒè´£:        â”‚          â”‚ èŒè´£:        â”‚         â”‚
â”‚   â”‚ åˆ†æè„šæœ¬ç‰¹å¾ â”‚          â”‚ ç»“æ„åˆ†æ     â”‚          â”‚ ç”Ÿæˆè§†è§‰é…ç½® â”‚         â”‚
â”‚   â”‚ åŒ¹é…æœ€ä½³æ¨¡ç‰ˆ â”‚          â”‚ è¯†åˆ«å†…å®¹ç±»å‹ â”‚          â”‚ ç»„ä»¶ç¼–æ’     â”‚         â”‚
â”‚   â”‚             â”‚          â”‚ æå–æ•°æ®     â”‚          â”‚ æ—¶é—´çº¿è§„åˆ’   â”‚         â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚   â”‚ å·¥å…·:        â”‚          â”‚ å·¥å…·:        â”‚          â”‚ å·¥å…·:        â”‚         â”‚
â”‚   â”‚ - æ¨¡ç‰ˆåº“æŸ¥è¯¢ â”‚          â”‚ - RAG æ£€ç´¢   â”‚          â”‚ - RAG æ£€ç´¢   â”‚         â”‚
â”‚   â”‚ - ç‰¹å¾åŒ¹é…å™¨ â”‚          â”‚ - NER æå–   â”‚          â”‚ - ç»„ä»¶åº“æŸ¥è¯¢ â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                         â”‚                         â”‚               â”‚
â”‚          â”‚                         â–¼                         â”‚               â”‚
â”‚          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚               â”‚
â”‚          â”‚               â”‚  çŸ¥è¯†åº“ (RAG)    â”‚                 â”‚               â”‚
â”‚          â”‚               â”‚                 â”‚                 â”‚               â”‚
â”‚          â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚               â”‚
â”‚          â”‚               â”‚  â”‚ æ ‡æ†ç‰‡æ®µ   â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚          â”‚               â”‚  â”‚ Benchmark â”‚  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”‚ Segments  â”‚  â”‚                                 â”‚
â”‚          â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”‚ æ¨¡ç‰ˆé…ç½®   â”‚  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚          â”‚               â”‚  â”‚ Templates â”‚  â”‚                                 â”‚
â”‚          â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”‚ ç»„ä»¶è§„èŒƒ   â”‚  â”‚                                 â”‚
â”‚          â”‚               â”‚  â”‚Components â”‚  â”‚                                 â”‚
â”‚          â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                 â”‚
â”‚          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚          â”‚                         â”‚                                         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                       â–¼                                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚              â”‚    EVALUATOR    â”‚   (å¯é€‰: Evaluator-Optimizer æ‰©å±•)           â”‚
â”‚              â”‚    è¯„ä¼°å™¨        â”‚                                             â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                             â”‚
â”‚              â”‚ æ£€æŸ¥:            â”‚                                             â”‚
â”‚              â”‚ - è§†è§‰èŠ‚å¥æ˜¯å¦åˆç†â”‚                                             â”‚
â”‚              â”‚ - ç»„ä»¶æ˜¯å¦å†²çª   â”‚                                             â”‚
â”‚              â”‚ - æ˜¯å¦ç¬¦åˆæ¨¡ç‰ˆè§„èŒƒâ”‚                                             â”‚
â”‚              â”‚                 â”‚                                             â”‚
â”‚              â”‚ å†³ç­–:            â”‚                                             â”‚
â”‚              â”‚ - é€šè¿‡ â†’ è¾“å‡º    â”‚                                             â”‚
â”‚              â”‚ - ä¸é€šè¿‡ â†’ è¿­ä»£  â”‚                                             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                       â”‚                                                      â”‚
â”‚                       â–¼                                                      â”‚
â”‚                 VisualConfig                                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 LangGraph çŠ¶æ€æœºå®ç°

#### 7.3.1 çŠ¶æ€å®šä¹‰

```python
# backend/app/services/remotion_agent/graph/state.py

from typing import TypedDict, List, Optional, Literal
from langgraph.graph import StateGraph

class AgentState(TypedDict):
    """Remotion Agent çš„å…¨å±€çŠ¶æ€"""
    
    # è¾“å…¥
    script: str                           # åŸå§‹è„šæœ¬
    user_preferences: dict                # ç”¨æˆ·åå¥½ (æ¨¡ç‰ˆã€é£æ ¼ç­‰)
    
    # ä¸­é—´çŠ¶æ€
    current_stage: Literal[
        "routing",      # æ¨¡ç‰ˆè·¯ç”±
        "analysis",     # å†…å®¹åˆ†æ  
        "visual",       # è§†è§‰è®¾è®¡
        "review",       # è¯„å®¡
        "complete"      # å®Œæˆ
    ]
    
    segments: List[dict]                  # åˆ†æåçš„ç‰‡æ®µ
    selected_template: Optional[str]      # é€‰å®šçš„æ¨¡ç‰ˆ
    
    # Worker ç»“æœ
    router_result: Optional[dict]         # è·¯ç”±ç»“æœ
    analysis_result: Optional[dict]       # åˆ†æç»“æœ
    visual_result: Optional[dict]         # è§†è§‰é…ç½®
    
    # è¿­ä»£æ§åˆ¶
    iteration_count: int                  # å½“å‰è¿­ä»£æ¬¡æ•°
    max_iterations: int                   # æœ€å¤§è¿­ä»£æ¬¡æ•°
    evaluation_feedback: Optional[str]    # è¯„ä¼°åé¦ˆ (ç”¨äºè¿­ä»£æ”¹è¿›)
    
    # è¾“å‡º
    final_config: Optional[dict]          # æœ€ç»ˆè§†è§‰é…ç½®
    error: Optional[str]                  # é”™è¯¯ä¿¡æ¯
```

#### 7.3.2 å›¾ç»“æ„å®šä¹‰

```python
# backend/app/services/remotion_agent/graph/workflow.py

from langgraph.graph import StateGraph, END
from langgraph.checkpoint.sqlite import SqliteSaver

def create_remotion_agent_graph() -> StateGraph:
    """åˆ›å»º Remotion Agent çš„ LangGraph å·¥ä½œæµ"""
    
    workflow = StateGraph(AgentState)
    
    # ============ æ·»åŠ èŠ‚ç‚¹ (Nodes) ============
    
    # 1. æ¨¡ç‰ˆè·¯ç”±èŠ‚ç‚¹
    workflow.add_node("template_router", template_router_node)
    
    # 2. å†…å®¹åˆ†æèŠ‚ç‚¹ 
    workflow.add_node("content_analyzer", content_analyzer_node)
    
    # 3. è§†è§‰è®¾è®¡èŠ‚ç‚¹
    workflow.add_node("visual_designer", visual_designer_node)
    
    # 4. è¯„ä¼°èŠ‚ç‚¹
    workflow.add_node("evaluator", evaluator_node)
    
    # 5. ä¼˜åŒ–èŠ‚ç‚¹ (è¿­ä»£æ”¹è¿›)
    workflow.add_node("optimizer", optimizer_node)
    
    # ============ æ·»åŠ è¾¹ (Edges) ============
    
    # å…¥å£ â†’ æ¨¡ç‰ˆè·¯ç”±
    workflow.set_entry_point("template_router")
    
    # æ¨¡ç‰ˆè·¯ç”± â†’ å†…å®¹åˆ†æ
    workflow.add_edge("template_router", "content_analyzer")
    
    # å†…å®¹åˆ†æ â†’ è§†è§‰è®¾è®¡
    workflow.add_edge("content_analyzer", "visual_designer")
    
    # è§†è§‰è®¾è®¡ â†’ è¯„ä¼°
    workflow.add_edge("visual_designer", "evaluator")
    
    # è¯„ä¼° â†’ æ¡ä»¶è·¯ç”± (é€šè¿‡/è¿­ä»£)
    workflow.add_conditional_edges(
        "evaluator",
        should_iterate,  # è·¯ç”±å‡½æ•°
        {
            "pass": END,           # è¯„ä¼°é€šè¿‡ â†’ ç»“æŸ
            "iterate": "optimizer", # éœ€è¦æ”¹è¿› â†’ ä¼˜åŒ–
            "fail": END            # è¶…è¿‡æœ€å¤§è¿­ä»£ â†’ ç»“æŸ
        }
    )
    
    # ä¼˜åŒ– â†’ è§†è§‰è®¾è®¡ (é‡æ–°ç”Ÿæˆ)
    workflow.add_edge("optimizer", "visual_designer")
    
    return workflow


def should_iterate(state: AgentState) -> str:
    """å†³å®šæ˜¯å¦éœ€è¦è¿­ä»£ä¼˜åŒ–"""
    
    if state.get("evaluation_passed", False):
        return "pass"
    
    if state["iteration_count"] >= state["max_iterations"]:
        return "fail"
    
    return "iterate"
```

#### 7.3.3 èŠ‚ç‚¹å®ç°ç¤ºä¾‹

```python
# backend/app/services/remotion_agent/graph/nodes.py

from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate

# ============ æ¨¡ç‰ˆè·¯ç”±èŠ‚ç‚¹ ============

async def template_router_node(state: AgentState) -> AgentState:
    """
    Worker 1: åˆ†æè„šæœ¬ç‰¹å¾ï¼ŒåŒ¹é…æœ€ä½³æ¨¡ç‰ˆ
    
    ä½¿ç”¨ RAG æ£€ç´¢ç›¸ä¼¼è„šæœ¬çš„æ¨¡ç‰ˆé€‰æ‹©å†å²
    """
    
    llm = ChatOpenAI(model="gpt-4", temperature=0)
    
    # 1. æ£€ç´¢ç›¸ä¼¼è„šæœ¬çš„æ¨¡ç‰ˆé€‰æ‹©æ¡ˆä¾‹
    similar_cases = await rag_retriever.search(
        query=state["script"][:500],  # å–å‰500å­—
        collection="template_routing_cases",
        k=3
    )
    
    # 2. æ„å»º Few-Shot Prompt
    prompt = ChatPromptTemplate.from_messages([
        ("system", TEMPLATE_ROUTER_SYSTEM_PROMPT),
        ("human", TEMPLATE_ROUTER_USER_PROMPT.format(
            similar_cases=format_cases(similar_cases),
            script=state["script"]
        ))
    ])
    
    # 3. è°ƒç”¨ LLM
    result = await (prompt | llm | JsonOutputParser()).ainvoke({})
    
    # 4. æ›´æ–°çŠ¶æ€
    return {
        **state,
        "selected_template": result["template_id"],
        "router_result": result,
        "current_stage": "analysis"
    }


# ============ å†…å®¹åˆ†æèŠ‚ç‚¹ ============

async def content_analyzer_node(state: AgentState) -> AgentState:
    """
    Worker 2: ç»“æ„åˆ†æï¼Œè¯†åˆ«å†…å®¹ç±»å‹ï¼Œæå–å…³é”®æ•°æ®
    
    è¿™æ˜¯æ ¸å¿ƒèŠ‚ç‚¹ï¼Œå†³å®šæ¯ä¸ªç‰‡æ®µçš„è§†è§‰å‘ˆç°æ–¹å¼
    """
    
    template_id = state["selected_template"]
    
    # 1. æ£€ç´¢è¯¥æ¨¡ç‰ˆä¸‹çš„æ ‡æ†åˆ†ææ¡ˆä¾‹
    benchmark_analyses = await rag_retriever.search(
        query=state["script"],
        collection="benchmark_segments",
        filter={"template_id": template_id},
        k=5
    )
    
    # 2. ä½¿ç”¨ LLM è¿›è¡Œç»“æ„åˆ†æ
    prompt = ChatPromptTemplate.from_messages([
        ("system", CONTENT_ANALYZER_SYSTEM_PROMPT.format(
            template_id=template_id,
            template_rules=TEMPLATE_RULES[template_id]
        )),
        ("human", CONTENT_ANALYZER_USER_PROMPT.format(
            benchmarks=format_benchmarks(benchmark_analyses),
            script=state["script"]
        ))
    ])
    
    llm = ChatOpenAI(model="gpt-4", temperature=0.3)
    result = await (prompt | llm | StructuredSegmentParser()).ainvoke({})
    
    return {
        **state,
        "segments": result["segments"],
        "analysis_result": result,
        "current_stage": "visual"
    }


# ============ è§†è§‰è®¾è®¡èŠ‚ç‚¹ ============

async def visual_designer_node(state: AgentState) -> AgentState:
    """
    Worker 3: åŸºäºåˆ†æç»“æœç”Ÿæˆè§†è§‰é…ç½®
    
    æ ¸å¿ƒ: ä½¿ç”¨ RAG æ£€ç´¢ç›¸ä¼¼å†…å®¹çš„è§†è§‰è®¾è®¡èŒƒä¾‹
    """
    
    segments = state["segments"]
    template_id = state["selected_template"]
    
    # å¯¹æ¯ä¸ªç‰‡æ®µç”Ÿæˆè§†è§‰é…ç½®
    visual_configs = []
    
    for segment in segments:
        # 1. æ£€ç´¢ç›¸ä¼¼ç‰‡æ®µçš„è§†è§‰é…ç½®
        similar_visuals = await rag_retriever.search(
            query=segment["text"],
            collection="visual_configs",
            filter={
                "template_id": template_id,
                "content_type": segment["content_type"]
            },
            k=3
        )
        
        # 2. Few-Shot ç”Ÿæˆè§†è§‰é…ç½®
        config = await generate_visual_config_with_rag(
            segment=segment,
            similar_examples=similar_visuals,
            template_rules=TEMPLATE_RULES[template_id],
            # å¦‚æœæ˜¯è¿­ä»£ï¼Œå¸¦å…¥ä¹‹å‰çš„åé¦ˆ
            feedback=state.get("evaluation_feedback")
        )
        
        visual_configs.append(config)
    
    # 3. åˆå¹¶æ‰€æœ‰ç‰‡æ®µçš„é…ç½®
    final_config = merge_visual_configs(visual_configs, template_id)
    
    return {
        **state,
        "visual_result": visual_configs,
        "final_config": final_config,
        "current_stage": "review"
    }


# ============ è¯„ä¼°èŠ‚ç‚¹ ============

async def evaluator_node(state: AgentState) -> AgentState:
    """
    Evaluator: è¯„ä¼°ç”Ÿæˆçš„è§†è§‰é…ç½®è´¨é‡
    
    æ£€æŸ¥é¡¹:
    1. è§†è§‰èŠ‚å¥ (æ˜¯å¦æ¯ 5 ç§’æœ‰å˜åŒ–)
    2. ç»„ä»¶å†²çª (æ˜¯å¦æœ‰é‡å )
    3. æ¨¡ç‰ˆåˆè§„ (æ˜¯å¦ç¬¦åˆæ¨¡ç‰ˆè§„èŒƒ)
    4. æ•°æ®ä¸€è‡´æ€§ (æ•°å­—æ˜¯å¦æ­£ç¡®æå–)
    """
    
    config = state["final_config"]
    template_id = state["selected_template"]
    
    # 1. è§„åˆ™æ£€æŸ¥ (é LLM)
    rule_issues = run_rule_checks(config, template_id)
    
    # 2. LLM è¯­ä¹‰æ£€æŸ¥
    llm = ChatOpenAI(model="gpt-4", temperature=0)
    
    prompt = ChatPromptTemplate.from_messages([
        ("system", EVALUATOR_SYSTEM_PROMPT),
        ("human", EVALUATOR_USER_PROMPT.format(
            script=state["script"],
            config=json.dumps(config, indent=2),
            template_rules=TEMPLATE_RULES[template_id]
        ))
    ])
    
    evaluation = await (prompt | llm | EvaluationParser()).ainvoke({})
    
    # 3. ç»¼åˆåˆ¤æ–­
    all_issues = rule_issues + evaluation.get("issues", [])
    passed = len(all_issues) == 0
    
    return {
        **state,
        "evaluation_passed": passed,
        "evaluation_feedback": "\n".join(all_issues) if all_issues else None,
        "iteration_count": state["iteration_count"] + 1
    }
```

### 7.4 Human-in-the-Loop (äººæœºåä½œ)

> **å…³é”®æ´å¯Ÿ**: ç”Ÿäº§çº§ Agent ä¸åº”è¯¥æ˜¯å®Œå…¨è‡ªä¸»çš„ã€‚åœ¨å…³é”®èŠ‚ç‚¹åº”è¯¥æ”¯æŒäººå·¥ä»‹å…¥ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Human-in-the-Loop è®¾è®¡                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚   ç”¨æˆ·è¾“å…¥    â”‚                                                  â”‚
â”‚   â”‚   è„šæœ¬+åå¥½   â”‚                                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ æ¨¡ç‰ˆè·¯ç”±      â”‚â”€â”€â”€â”€â–¶â”‚  ğŸ”” æ£€æŸ¥ç‚¹ 1: æ¨¡ç‰ˆç¡®è®¤                 â”‚   â”‚
â”‚   â”‚              â”‚     â”‚  "å»ºè®®ä½¿ç”¨ mixed-media æ¨¡ç‰ˆï¼Œæ˜¯å¦åŒæ„ï¼Ÿ" â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  [åŒæ„] [æ¢æˆ talking-head] [å…¶ä»–]      â”‚   â”‚
â”‚          â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ å†…å®¹åˆ†æ      â”‚â”€â”€â”€â”€â–¶â”‚  ğŸ”” æ£€æŸ¥ç‚¹ 2: ç»“æ„é¢„è§ˆ (å¯é€‰)          â”‚   â”‚
â”‚   â”‚              â”‚     â”‚  å±•ç¤ºè¯†åˆ«å‡ºçš„è¦ç‚¹åˆ—è¡¨ã€æ•°æ®ç‚¹ç­‰         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  ç”¨æˆ·å¯ä»¥ä¿®æ­£é”™è¯¯è¯†åˆ«                   â”‚   â”‚
â”‚          â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚ è§†è§‰è®¾è®¡      â”‚                                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ è¯„ä¼°          â”‚â”€â”€â”€â”€â–¶â”‚  ğŸ”” æ£€æŸ¥ç‚¹ 3: é¢„è§ˆç¡®è®¤                 â”‚   â”‚
â”‚   â”‚              â”‚     â”‚  å±•ç¤ºç”Ÿæˆçš„è§†è§‰é…ç½®é¢„è§ˆ                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  [ä½¿ç”¨æ­¤é…ç½®] [é‡æ–°ç”Ÿæˆ] [æ‰‹åŠ¨è°ƒæ•´]     â”‚   â”‚
â”‚          â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â–¼                                                          â”‚
â”‚       è¾“å‡ºé…ç½®                                                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LangGraph Checkpointer å®ç°**:

```python
from langgraph.checkpoint.sqlite import SqliteSaver

# åˆ›å»ºæ£€æŸ¥ç‚¹å­˜å‚¨
checkpointer = SqliteSaver.from_conn_string("checkpoints.db")

# ç¼–è¯‘å¸¦æ£€æŸ¥ç‚¹çš„å›¾
app = workflow.compile(
    checkpointer=checkpointer,
    interrupt_before=["evaluator"]  # åœ¨è¯„ä¼°å‰æš‚åœï¼Œç­‰å¾…äººå·¥ç¡®è®¤
)

# è¿è¡Œåˆ°æ£€æŸ¥ç‚¹
thread_id = "user_123_session_456"
config = {"configurable": {"thread_id": thread_id}}

# ç¬¬ä¸€æ¬¡è¿è¡Œ (ä¼šåœ¨ evaluator å‰æš‚åœ)
result = await app.ainvoke(initial_state, config)

# ... ç”¨æˆ·æŸ¥çœ‹é¢„è§ˆï¼Œåšå‡ºå†³å®š ...

# ç»§ç»­è¿è¡Œ (å¸¦ä¸Šç”¨æˆ·çš„ä¿®æ”¹)
updated_state = {"user_approved": True, "user_modifications": {...}}
final_result = await app.ainvoke(updated_state, config)
```

### 7.5 å·¥å…· (Tools) è®¾è®¡

> **Anthropic å»ºè®®**: Agent çš„å·¥å…·è®¾è®¡è¦æŠ•å…¥ä¸ HCI (äººæœºäº¤äº’) åŒç­‰çš„ç²¾åŠ›ã€‚å·¥å…·å®šä¹‰è¦æ¸…æ™°ã€æœ‰ç¤ºä¾‹ã€æœ‰è¾¹ç•Œã€‚

```python
# backend/app/services/remotion_agent/tools.py

from langchain.tools import tool

@tool
def search_benchmark_segments(
    query: str,
    template_id: str,
    content_type: str | None = None,
    k: int = 3
) -> list[dict]:
    """
    ä»æ ‡æ†çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸ä¼¼çš„è§†é¢‘ç‰‡æ®µã€‚
    
    Args:
        query: æœç´¢æ–‡æœ¬ (é€šå¸¸æ˜¯è„šæœ¬ç‰‡æ®µ)
        template_id: æ¨¡ç‰ˆIDï¼Œåªæ£€ç´¢åŒæ¨¡ç‰ˆçš„æ ‡æ†
                    å¯é€‰å€¼: mixed-media, talking-head, whiteboard, screencast, videographic, slideshow
        content_type: å†…å®¹ç±»å‹è¿‡æ»¤ (å¯é€‰)
                     å¯é€‰å€¼: data, opinion, story, comparison, concept, hook, cta
        k: è¿”å›çš„æ ‡æ†æ•°é‡ï¼Œé»˜è®¤3ä¸ª
    
    Returns:
        ç›¸ä¼¼æ ‡æ†ç‰‡æ®µåˆ—è¡¨ï¼Œæ¯ä¸ªåŒ…å«:
        - script_text: æ ‡æ†è„šæœ¬
        - visual_config: æ ‡æ†çš„è§†è§‰é…ç½®
        - reasoning: è®¾è®¡ç†ç”±
        - benchmark_creator: æ ‡æ†åšä¸»
    
    Example:
        search_benchmark_segments(
            query="ç ”ç©¶è¡¨æ˜ï¼Œæ¯å¤©é˜…è¯»30åˆ†é’Ÿçš„äººï¼Œå¹´æ”¶å…¥å¹³å‡é«˜å‡º25%",
            template_id="mixed-media",
            content_type="data"
        )
        # è¿”å› Ali Abdaal ç­‰åšä¸»å¤„ç†ç±»ä¼¼æ•°æ®çš„è§†è§‰é…ç½®
    """
    # å®ç°...


@tool
def get_template_rules(template_id: str) -> dict:
    """
    è·å–æŒ‡å®šæ¨¡ç‰ˆçš„è§†è§‰è§„åˆ™å’Œçº¦æŸã€‚
    
    Args:
        template_id: æ¨¡ç‰ˆID
                    å¯é€‰å€¼: mixed-media, talking-head, whiteboard, screencast, videographic, slideshow
    
    Returns:
        æ¨¡ç‰ˆè§„åˆ™ï¼ŒåŒ…å«:
        - constraints: çº¦æŸåˆ—è¡¨ (å¦‚ "æ¯5ç§’å¿…é¡»æœ‰è§†è§‰å˜åŒ–")
        - recommended_components: æ¨èç»„ä»¶åˆ—è¡¨
        - forbidden_components: ç¦ç”¨ç»„ä»¶åˆ—è¡¨
        - visual_rhythm: è§†è§‰èŠ‚å¥è¦æ±‚
        - pip_settings: ç”»ä¸­ç”»é»˜è®¤é…ç½®
    
    Example:
        get_template_rules("mixed-media")
        # è¿”å› {"constraints": ["No static > 5s", ...], ...}
    """
    # å®ç°...


@tool  
def validate_visual_config(config: dict, template_id: str) -> dict:
    """
    éªŒè¯è§†è§‰é…ç½®æ˜¯å¦ç¬¦åˆæ¨¡ç‰ˆè§„èŒƒã€‚
    
    Args:
        config: VisualConfig JSON å¯¹è±¡
        template_id: æ¨¡ç‰ˆID
    
    Returns:
        éªŒè¯ç»“æœ:
        - valid: bool, æ˜¯å¦é€šè¿‡éªŒè¯
        - errors: é”™è¯¯åˆ—è¡¨ (ä¸¥é‡é—®é¢˜ï¼Œå¿…é¡»ä¿®å¤)
        - warnings: è­¦å‘Šåˆ—è¡¨ (å»ºè®®ä¼˜åŒ–)
        - suggestions: æ”¹è¿›å»ºè®®
    
    Example:
        validate_visual_config(
            config={"overlays": [...]},
            template_id="mixed-media"
        )
        # è¿”å› {"valid": False, "errors": ["é™æ­¢ç”»é¢è¶…è¿‡10ç§’"], ...}
    """
    # å®ç°...


@tool
def get_component_spec(component_type: str) -> dict:
    """
    è·å– Remotion ç»„ä»¶çš„è§„æ ¼è¯´æ˜ã€‚
    
    Args:
        component_type: ç»„ä»¶ç±»å‹
                       å¯é€‰å€¼: keyword-card, data-number, highlight-box, process-flow,
                              point-list, comparison-table, quote-block, chapter-title
    
    Returns:
        ç»„ä»¶è§„æ ¼:
        - props: ç»„ä»¶å±æ€§åŠå…¶ç±»å‹
        - required_props: å¿…å¡«å±æ€§
        - animation_options: æ”¯æŒçš„åŠ¨ç”»æ•ˆæœ
        - position_options: æ”¯æŒçš„ä½ç½®
        - example: ä½¿ç”¨ç¤ºä¾‹
    """
    # å®ç°...
```

### 7.6 é”™è¯¯å¤„ç†ä¸å›é€€ç­–ç•¥

```python
# backend/app/services/remotion_agent/graph/error_handling.py

from langgraph.graph import StateGraph

def create_robust_agent_graph() -> StateGraph:
    """å¸¦æœ‰å®Œæ•´é”™è¯¯å¤„ç†çš„ Agent å›¾"""
    
    workflow = StateGraph(AgentState)
    
    # ... æ·»åŠ èŠ‚ç‚¹ ...
    
    # æ·»åŠ é”™è¯¯å¤„ç†è¾¹
    workflow.add_conditional_edges(
        "visual_designer",
        handle_design_errors,
        {
            "success": "evaluator",
            "partial_failure": "fallback_designer",  # éƒ¨åˆ†å¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–ç­–ç•¥
            "total_failure": "error_handler"          # å®Œå…¨å¤±è´¥ï¼Œç”Ÿæˆé»˜è®¤é…ç½®
        }
    )
    
    # å›é€€èŠ‚ç‚¹: ä½¿ç”¨ç®€åŒ–çš„è§„åˆ™å¼•æ“ç”Ÿæˆé…ç½®
    workflow.add_node("fallback_designer", fallback_designer_node)
    workflow.add_edge("fallback_designer", "evaluator")
    
    # é”™è¯¯å¤„ç†èŠ‚ç‚¹: ç”Ÿæˆæœ€å°å¯ç”¨é…ç½®
    workflow.add_node("error_handler", error_handler_node)
    workflow.add_edge("error_handler", END)
    
    return workflow


async def fallback_designer_node(state: AgentState) -> AgentState:
    """
    å›é€€ç­–ç•¥: å½“ LLM ç”Ÿæˆå¤±è´¥æ—¶ï¼Œä½¿ç”¨è§„åˆ™å¼•æ“ç”ŸæˆåŸºç¡€é…ç½®
    
    è¿™ç¡®ä¿äº†å³ä½¿ AI å‡ºé”™ï¼Œç”¨æˆ·ä¹Ÿèƒ½å¾—åˆ°å¯ç”¨çš„è¾“å‡º
    """
    
    # ä½¿ç”¨ç®€å•è§„åˆ™ç”Ÿæˆé…ç½®
    config = rule_based_visual_generator(
        segments=state["segments"],
        template_id=state["selected_template"]
    )
    
    return {
        **state,
        "final_config": config,
        "fallback_used": True,
        "current_stage": "review"
    }


async def error_handler_node(state: AgentState) -> AgentState:
    """
    æœ€ç»ˆå›é€€: ç”Ÿæˆæœ€å°å¯ç”¨é…ç½® (åªæœ‰å­—å¹•)
    """
    
    minimal_config = {
        "version": "2.0",
        "template": state.get("selected_template", "whiteboard"),
        "mainVideo": {"defaultMode": "fullscreen"},
        "subtitles": {"enabled": True, "style": "modern"},
        "overlays": [],
        "canvas": None
    }
    
    return {
        **state,
        "final_config": minimal_config,
        "error": state.get("error", "Unknown error, using minimal config"),
        "current_stage": "complete"
    }
```

### 7.7 ç›‘æ§ä¸å¯è§‚æµ‹æ€§

```python
# backend/app/services/remotion_agent/monitoring.py

from langsmith import Client
import structlog

logger = structlog.get_logger()

class AgentMonitor:
    """Agent è¿è¡Œç›‘æ§"""
    
    def __init__(self):
        self.langsmith = Client()
    
    async def log_node_execution(
        self,
        node_name: str,
        state: AgentState,
        result: dict,
        duration_ms: float
    ):
        """è®°å½•èŠ‚ç‚¹æ‰§è¡Œä¿¡æ¯"""
        
        logger.info(
            "agent_node_executed",
            node=node_name,
            template=state.get("selected_template"),
            iteration=state.get("iteration_count"),
            duration_ms=duration_ms,
            success=result.get("success", True)
        )
        
        # å‘é€åˆ° LangSmith ç”¨äºè°ƒè¯•
        self.langsmith.log_run(
            name=f"remotion_agent.{node_name}",
            inputs={"state": state},
            outputs=result,
            extra={"duration_ms": duration_ms}
        )
    
    async def log_rag_retrieval(
        self,
        query: str,
        results: list,
        collection: str,
        latency_ms: float
    ):
        """è®°å½• RAG æ£€ç´¢ä¿¡æ¯"""
        
        logger.info(
            "rag_retrieval",
            collection=collection,
            query_length=len(query),
            result_count=len(results),
            latency_ms=latency_ms
        )
    
    async def log_evaluation_result(
        self,
        passed: bool,
        issues: list,
        iteration: int
    ):
        """è®°å½•è¯„ä¼°ç»“æœ"""
        
        logger.info(
            "evaluation_completed",
            passed=passed,
            issue_count=len(issues),
            iteration=iteration
        )
```

### 7.8 æ¶æ„å†³ç­–æ€»ç»“

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|-------|------|------|
| æ•´ä½“æ¨¡å¼ | Orchestrator-Workers | ä»»åŠ¡å¯åˆ†è§£ä½†å­ä»»åŠ¡ä¸é¢„å®šä¹‰ï¼Œéœ€è¦åŠ¨æ€è°ƒåº¦ |
| æ˜¯å¦å…¨è‡ªä¸» | å¦ï¼ŒHuman-in-the-Loop | è§†é¢‘åˆ¶ä½œéœ€è¦ä¸»è§‚åˆ¤æ–­ï¼Œå…³é”®èŠ‚ç‚¹éœ€äººå·¥ç¡®è®¤ |
| RAG ä½ç½® | æ¯ä¸ª Worker éƒ½ç”¨ | æ¨¡ç‰ˆé€‰æ‹©ã€å†…å®¹åˆ†æã€è§†è§‰è®¾è®¡éƒ½éœ€è¦æ ‡æ†å‚è€ƒ |
| è¿­ä»£ç­–ç•¥ | Evaluator-Optimizer | ç”Ÿæˆè´¨é‡éœ€è¦è¯„ä¼°ï¼Œä¸åˆæ ¼éœ€è¦è¿­ä»£ |
| é”™è¯¯å¤„ç† | å¤šå±‚å›é€€ | ä¿è¯ç”¨æˆ·å§‹ç»ˆæœ‰å¯ç”¨è¾“å‡º |
| æ¡†æ¶é€‰æ‹© | LangGraph | çŠ¶æ€æœºè¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ”¯æŒæ£€æŸ¥ç‚¹å’Œä¸­æ–­ |

---

## 8. æ ‡æ†è§†é¢‘åˆ†æç»“è®ºé›†æˆ (2026-01-31 æ›´æ–°)

> åŸºäº 8 ä¸ªæ ‡æ†è§†é¢‘åˆ†æï¼Œå°†è§„å¾‹è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„ Agent è§„åˆ™

### 8.1 å››ç§å¸ƒå±€æ¨¡å¼ (ä»æ ‡æ†è§†é¢‘æç‚¼)

| æ¨¡å¼ | æè¿° | äººç‰©å æ¯” | è§¦å‘æ¡ä»¶ | æ ‡æ†è§†é¢‘ |
|------|------|----------|----------|----------|
| **A** | äººç‰©å…¨å± + B-Rollç”»ä¸­ç”» | 70% | é»˜è®¤/å£æ’­ | 001,002,006,007,008 |
| **B** | ç´ æå…¨å± + äººç‰©ç”»ä¸­ç”» | 20-30% | æ¼”ç¤º/æ•™å­¦ | 004,005 |
| **C** | çº¯ç´ ææ— äººç‰© | 0% | ç™½æ¿/PPT | 003 |
| **D** | çµæ´»åˆ‡æ¢ | åŠ¨æ€ | é•¿è§†é¢‘(>4åˆ†é’Ÿ) | 006,007,008 |

### 8.2 å…­ç§ B-Roll è§¦å‘ç±»å‹

| è§¦å‘ç±»å‹ | å£æ’­ç‰¹å¾ | B-Roll å†…å®¹ | æ’å…¥æ–¹å¼ | æ—¶é•¿ |
|----------|----------|-------------|----------|------|
| **äººç‰©** | æåˆ°äººå | è¯¥äººç‰©ç”»é¢ | ç”»ä¸­ç”» | 3-5s |
| **äº§å“** | æåˆ°å“ç‰Œ | Logo/ç•Œé¢ | ç”»ä¸­ç”» | 2-4s |
| **æ¦‚å¿µ** | æŠ½è±¡å®šä¹‰ | å¯è§†åŒ–åŠ¨ç”» | Canvas/ç”»ä¸­ç”» | 3-6s |
| **åœºæ™¯** | åœºæ™¯æè¿° | å®æ‹/åŠ¨ç”» | ç”»ä¸­ç”»/å…¨å± | 4-8s |
| **æ¼”ç¤º** | å·¥å…·æ“ä½œ | å±å¹•å½•åˆ¶ | å…¨å±+äººç‰©ç”»ä¸­ç”» | 10-40s |
| **æ•°æ®** | æ•°å­—/è®ºç‚¹ | å›¾è¡¨/åˆ—è¡¨ | Canvasç»„ä»¶ | 5-20s |

### 8.3 å…³é”®è¯å¡ç‰‡å˜ä½“ (5ç§)

```
dark-solid     â†’ é»‘åº•ç™½å­—ï¼Œå·¦ä¸Šè§’å›ºå®š (åˆ—è¡¨å‹)
light-solid    â†’ ç™½åº•é»‘å­—ï¼Œä¸­å¤®å±•ç¤º (PPTå‹)
semi-transparent â†’ åŠé€æ˜ï¼Œå±…ä¸­å¼¹å‡º (å£æ’­å‹)
gradient       â†’ å“ç‰Œæ¸å˜ï¼Œç‰¹æ®Šå¼ºè°ƒ
numbered       â†’ å¸¦æ•°å­—ç¼–å·ï¼Œå¤šç‚¹è®ºè¿°
```

### 8.4 èŠ‚å¥è§„å¾‹

| è§†é¢‘æ—¶é•¿ | å¹³å‡é•œå¤´æ—¶é•¿ | èŠ‚å¥ç‰¹ç‚¹ |
|----------|--------------|----------|
| 1-2åˆ†é’Ÿ | 3-6ç§’ | å¿«èŠ‚å¥ |
| 2-5åˆ†é’Ÿ | 4-10ç§’ | ä¸­ç­‰ |
| 5åˆ†é’Ÿ+ | 2-6ç§’ | å¿«åˆ‡æ¢ç»´æŒæ³¨æ„åŠ› |
| ç™½æ¿/PPT | 20-40ç§’ | å†…å®¹é©±åŠ¨ |

### 8.5 ç›¸å…³æ–‡æ¡£

- [BENCHMARK_CONCLUSION.md](./BENCHMARK_CONCLUSION.md) - 8ä¸ªæ ‡æ†è§†é¢‘è¯¦ç»†åˆ†æ
- [BENCHMARK_TO_REMOTION_INTEGRATION.md](./BENCHMARK_TO_REMOTION_INTEGRATION.md) - é›†æˆæ–¹æ¡ˆ
- [REMOTION_AGENT_GRANULAR_RULES.md](./REMOTION_AGENT_GRANULAR_RULES.md) - ç»†ç²’åº¦è§„åˆ™æ‰‹å†Œ

---

## 9. å®ç°è·¯çº¿å›¾ (æ›´æ–°)

### Phase 1: åŸºç¡€ Workflow (MVP) - Week 1-2
- [ ] LangGraph åŸºç¡€çŠ¶æ€æœºæ­å»º
- [ ] ä¸‰ä¸ª Worker èŠ‚ç‚¹ (Router, Analyzer, Designer)
- [ ] åŸºç¡€ RAG æ£€ç´¢ (Chroma + 50 æ ‡æ†ç‰‡æ®µ)
- [ ] KeywordCard, DataNumber, HighlightBox ç»„ä»¶
- [ ] **æ–°å¢**: 4ç§å¸ƒå±€æ¨¡å¼é…ç½®å®ç°
- [ ] **æ–°å¢**: å­—å¹•è§„èŒƒ (ç™½å­—é»‘è¾¹+é»„è‰²é«˜äº®)

### Phase 2: B-Roll å¢å¼º - Week 2-3
- [ ] **æ–°å¢**: 6ç§ B-Roll è§¦å‘è¯†åˆ«è§„åˆ™
- [ ] **æ–°å¢**: B-Roll è§¦å‘æ£€æµ‹ Prompt
- [ ] **æ–°å¢**: ç”»ä¸­ç”»ä½ç½®/å°ºå¯¸ç²¾ç¡®é…ç½®
- [ ] Evaluator èŠ‚ç‚¹
- [ ] Optimizer èŠ‚ç‚¹ (è¿­ä»£æ”¹è¿›)
- [ ] è§„åˆ™æ£€æŸ¥å™¨ (é LLM)

### Phase 3: ç»„ä»¶ä¸æ¨¡ç‰ˆ - Week 3-4
- [ ] ProcessFlowCanvas, PointListCanvas ç»„ä»¶
- [ ] ComparisonCanvas, ConceptCard ç»„ä»¶
- [ ] **æ–°å¢**: 5ç§å…³é”®è¯å¡ç‰‡å˜ä½“
- [ ] **æ–°å¢**: æ¨¡ç‰ˆå‚æ•°æ ¡å‡† (mixed-media/whiteboard/screencast)
- [ ] Human-in-the-Loop æ£€æŸ¥ç‚¹

### Phase 4: çŸ¥è¯†åº“ä¸éªŒè¯ - Week 4-5
- [ ] **æ–°å¢**: 8ä¸ªæ ‡æ†è§†é¢‘ç‰‡æ®µå…¥åº“ (åˆå§‹ç§å­æ•°æ®)
- [ ] AI è¾…åŠ©æ ‡æ³¨å·¥å…·
- [ ] **æ–°å¢**: è§†è§‰é…ç½®éªŒè¯è§„åˆ™
- [ ] **æ–°å¢**: èŠ‚å¥è®¡ç®—å™¨
- [ ] ç”¨æˆ·åé¦ˆé—­ç¯

### Phase 5: ç›‘æ§ä¸ä¼˜åŒ– - Week 5-6
- [ ] LangSmith é›†æˆ
- [ ] æ€§èƒ½ç›‘æ§ Dashboard
- [ ] **æ–°å¢**: ä¸æ ‡æ†è§†é¢‘å¯¹æ¯”æµ‹è¯•
- [ ] A/B æµ‹è¯•æ¡†æ¶
- [ ] æˆæœ¬ä¼˜åŒ– (æ¨¡å‹è·¯ç”±)

---

## 9. æŠ€æœ¯å®ç°è¦ç‚¹

### 9.1 æ–‡ä»¶ç»“æ„

```
backend/
  app/
    services/
      remotion_agent/
        __init__.py
        stage1_understanding.py   # å†…å®¹ç†è§£
        stage2_structure.py       # ç»“æ„åˆ†æ
        stage3_visual.py          # è§†è§‰ç¼–æ’
        prompts/
          understanding.py
          structure.py
        models.py                 # Pydantic æ¨¡å‹
        templates/
          __init__.py
          whiteboard.py           # ç™½æ¿è®²è§£é£æ¨¡ç‰ˆ (é»˜è®¤)
          talking_head.py         # å£æ’­ä¸»å¯¼é£æ¨¡ç‰ˆ
          base.py                 # æ¨¡ç‰ˆåŸºç±»

frontend/
  src/
    remotion/
      components/
        canvas/
          PointListCanvas.tsx     # è¦ç‚¹åˆ—è¡¨ç”»å¸ƒ
          ProcessFlowCanvas.tsx   # æµç¨‹/é€’è¿›å›¾
          ComparisonCanvas.tsx    # å¯¹æ¯”ç”»å¸ƒ
          ConceptCard.tsx         # æ¦‚å¿µå®šä¹‰å¡ç‰‡
        overlays/
          KeywordCard.tsx         # å…³é”®è¯å¡ç‰‡
          HighlightBox.tsx        # é«˜äº®æ¡†
          DataNumber.tsx          # æ•°å­—åŠ¨ç”»
          QuestionHook.tsx        # é—®é¢˜é’©å­
          ChapterTitle.tsx        # ç« èŠ‚æ ‡é¢˜
          QuoteBlock.tsx          # å¼•ç”¨å—
          ProgressIndicator.tsx   # è¿›åº¦æŒ‡ç¤º
        subtitles/
          AnimatedSubtitle.tsx    # åŠ¨ç”»å­—å¹•
        backgrounds/
          PaperBackground.tsx     # çº¸å¼ çº¹ç†èƒŒæ™¯
          GradientBackground.tsx  # æ¸å˜èƒŒæ™¯
      templates/
        index.ts                  # æ¨¡ç‰ˆæ³¨å†Œ
        whiteboard.ts             # ç™½æ¿è®²è§£é£æ¨¡ç‰ˆé…ç½® (é»˜è®¤)
        talkingHead.ts            # å£æ’­ä¸»å¯¼é£æ¨¡ç‰ˆé…ç½®
        types.ts                  # æ¨¡ç‰ˆç±»å‹å®šä¹‰
```

### 9.2 API è®¾è®¡

```typescript
// è¯·æ±‚
POST /api/workspace/sessions/{session_id}/generate-visual-config

{
  // å¯é€‰: æŒ‡å®šæ¨¡ç‰ˆ (é»˜è®¤: whiteboard)
  template?: 'whiteboard' | 'talking-head' | 'split-screen' | 'modern-slides' | 'dark-tech';
  
  // å¯é€‰: å¯ç”¨/ç¦ç”¨ç‰¹å®šç»„ä»¶
  enableCanvas?: boolean;
  enableOverlays?: boolean;
  
  // å¯é€‰: è¦†ç›–æ¨¡ç‰ˆé»˜è®¤èƒŒæ™¯
  backgroundOverride?: {
    type: 'paper' | 'white' | 'gradient';
    color?: string;
  };
}

// å“åº”
{
  status: 'success',
  template: 'whiteboard',     // ä½¿ç”¨çš„æ¨¡ç‰ˆ
  config: VisualConfig,
  analysis: {
    topic: string,
    structure: GlobalStructure,
    componentCount: {
      canvas: number,
      overlays: number
    }
  }
}
```

---

## 10. é™„å½•

### 10.1 å®Œæ•´ VisualConfig ç¤ºä¾‹

```json
{
  "version": "2.0",
  "template": "whiteboard",
  "duration_ms": 180000,
  "fps": 30,
  
  "background": {
    "type": "paper",
    "texture": "paper",
    "color": "#FFFEF5"
  },
  
  "mainVideo": {
    "url": "...",
    "defaultMode": "pip",
    "pip": {
      "position": "bottom-center",
      "size": "medium",
      "shape": "rectangle"
    }
  },
  
  "canvas": {
    "type": "process-flow",
    "processFlow": {
      "steps": [
        { 
          "id": "s1", 
          "text": "å¦‚ä½•ç”¨æœ€å°çš„æˆæœ¬æ¥éªŒè¯ä½ çš„äº§å“èƒ½ä¸èƒ½æ´»ä¸‹æ¥ï¼Ÿ", 
          "type": "question",
          "style": { "bordered": true, "color": "#E53935" },
          "activateAtMs": 0 
        },
        { 
          "id": "s2", 
          "text": "MVP:æœ€å°å¯æ‰§è¡Œäº§å“", 
          "type": "concept",
          "activateAtMs": 5000 
        },
        { 
          "id": "s3", 
          "text": "20%çš„æŠ•å…¥å°±èƒ½å®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„é—­ç¯", 
          "type": "explanation",
          "activateAtMs": 12000 
        },
        { 
          "id": "s4", 
          "text": "ä½ åªç”¨åš20%ï¼Œå°±èƒ½æ’¬åŠ¨80%ä»·å€¼", 
          "type": "conclusion",
          "activateAtMs": 20000 
        }
      ],
      "direction": "vertical",
      "connector": "arrow"
    }
  },
  
  "overlays": [
    {
      "id": "data-1",
      "type": "data-number",
      "start_ms": 12000,
      "end_ms": 18000,
      "content": { "value": "20%", "label": "æŠ•å…¥", "trend": "neutral" },
      "position": "top-right",
      "animation": { "enter": "zoom", "exit": "fade" }
    },
    {
      "id": "data-2",
      "type": "data-number",
      "start_ms": 20000,
      "end_ms": 26000,
      "content": { "value": "80%", "label": "ä»·å€¼", "trend": "up" },
      "position": "top-right",
      "animation": { "enter": "zoom", "exit": "fade" }
    },
    {
      "id": "highlight-1",
      "type": "highlight-box",
      "start_ms": 8000,
      "end_ms": 15000,
      "content": { "text": "MVP", "color": "#4CAF50", "style": "handdrawn" },
      "position": "center",
      "animation": { "enter": "draw", "exit": "fade" }
    }
  ],
  
  "subtitles": {
    "enabled": true,
    "style": "handwritten",
    "position": "bottom",
    "highlightKeywords": true,
    "highlightColor": "#FFEB3B"
  }
}
```

### 10.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|-----|------|
| Canvas | ç”»å¸ƒç»„ä»¶ï¼ŒæŒç»­æ˜¾ç¤ºçš„èƒŒæ™¯å†…å®¹ï¼ˆç”± Remotion æ¸²æŸ“ï¼‰ |
| Overlay | å åŠ ç»„ä»¶ï¼Œä¸´æ—¶æ˜¾ç¤ºçš„æµ®å±‚ï¼ˆç”± Remotion æ¸²æŸ“ï¼‰ |
| PiP | Picture-in-Pictureï¼Œç”»ä¸­ç”» |
| Hook | å¼€åœºé’©å­ï¼Œå¸å¼•æ³¨æ„åŠ›çš„å†…å®¹ |
| CTA | Call-to-Actionï¼Œè¡ŒåŠ¨å·å¬ |
| ProcessFlow | æµç¨‹/é€’è¿›å›¾ï¼Œç”¨ç®­å¤´è¿æ¥çš„å†…å®¹å±•ç¤º |
| HighlightBox | é«˜äº®æ¡†ï¼Œåœ¨å…³é”®è¯å‘¨å›´ç»˜åˆ¶è¾¹æ¡† |
| Handwritten | æ‰‹å†™é£æ ¼ï¼Œæ¨¡æ‹Ÿæ‰‹ç»˜æ•ˆæœçš„è§†è§‰é£æ ¼ |
