# B-roll Phase 2-4 åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°
æœ¬æ–‡æ¡£æè¿° B-roll åŠŸèƒ½çš„å¢å¼ºè®¡åˆ’ï¼ˆPhase 2-4ï¼‰ï¼ŒåŒ…æ‹¬è§†é¢‘ä¸‹è½½ã€æœç´¢å†å²ã€æ”¶è—ã€å¤šæºæ”¯æŒã€AI æ™ºèƒ½åŒ¹é…ç­‰åŠŸèƒ½ã€‚

---

## Phase 2: å¢å¼ºåŠŸèƒ½

### 2.1 æ ¸å¿ƒåŠŸèƒ½ï¼šè§†é¢‘ä¸‹è½½åˆ°é¡¹ç›®èµ„æºåº“

**ç›®æ ‡**ï¼šé¿å…ä¾èµ–å¤–éƒ¨ CDNï¼ˆPexels é“¾æ¥å¯èƒ½å¤±æ•ˆï¼‰ï¼Œæé«˜æ’­æ”¾ç¨³å®šæ€§ï¼Œæ”¯æŒç¦»çº¿ç¼–è¾‘

#### æ•°æ®åº“è®¾è®¡

```sql
-- åœ¨ assets è¡¨ä¸­å­˜å‚¨ B-roll è§†é¢‘
-- æ–°å¢å­—æ®µæ ‡è®° B-roll æ¥æº
ALTER TABLE assets ADD COLUMN IF NOT EXISTS broll_metadata JSONB;

-- broll_metadata ç»“æ„ç¤ºä¾‹:
{
  "source": "pexels",           -- æ¥æº: pexels | pixabay | kling
  "external_id": "123456",      -- å¤–éƒ¨å¹³å°ID
  "author": "Photographer Name",
  "author_url": "https://...",
  "original_url": "https://...", -- åŸå§‹é¡µé¢é“¾æ¥
  "license": "Pexels License",
  "keywords": ["nature", "sunset"],
  "quality": "hd",
  "orientation": "landscape"
}
```

#### åç«¯ API è®¾è®¡

**æ–°å¢ç«¯ç‚¹**ï¼š

1. **ä¸‹è½½ B-roll åˆ°é¡¹ç›®**
```http
POST /api/broll/download
Content-Type: application/json

{
  "project_id": "uuid",
  "video": {
    "id": 123456,
    "url": "https://player.vexels.com/...",
    "width": 1920,
    "height": 1080,
    "duration": 15,
    "thumbnail": "https://...",
    "source": "pexels",
    "author": "Name",
    "author_url": "https://..."
  }
}

Response:
{
  "asset_id": "uuid",
  "download_status": "downloading",
  "task_id": "uuid"
}
```

**å®ç°é€»è¾‘**ï¼š
- ä½¿ç”¨ Celery åå°ä»»åŠ¡ä¸‹è½½è§†é¢‘
- å­˜å‚¨åˆ° Supabase Storage `clips/{user_id}/broll/{asset_id}.mp4`
- åˆ›å»º asset è®°å½•ï¼Œæ ‡è®° `broll_metadata`
- æ”¯æŒä¸‹è½½è¿›åº¦æŸ¥è¯¢

2. **æŸ¥è¯¢ä¸‹è½½è¿›åº¦**
```http
GET /api/broll/download/{task_id}/status

Response:
{
  "status": "downloading",
  "progress": 65,
  "total_bytes": 15728640,
  "downloaded_bytes": 10223616,
  "asset_id": "uuid"
}
```

### 2.2 å‰ç«¯ç»„ä»¶æ”¹åŠ¨

**BRollPanel.tsx æ–°å¢åŠŸèƒ½**ï¼š
1. âœ… ä¸‹è½½æŒ‰é’® + è¿›åº¦æ¡æ˜¾ç¤º
2. âœ… æœç´¢å†å²ä¸‹æ‹‰èœå•ï¼ˆæœ€è¿‘10æ¡ï¼‰
3. âœ… æ”¶è—æŒ‰é’® + æ”¶è—åˆ—è¡¨æ ‡ç­¾é¡µ
4. âœ… é«˜çº§ç­›é€‰å™¨å±•å¼€/æŠ˜å é¢æ¿
5. âœ… ä¸‹è½½çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆå·²ä¸‹è½½/ä¸‹è½½ä¸­/æœªä¸‹è½½ï¼‰

---

## Phase 3: AI é›†æˆ

### 3.1 
**åœºæ™¯**ï¼šæ ¹æ®å½“å‰æ’­æ”¾ä½ç½®è‡ªåŠ¨æ¨èåŒ¹é…çš„ B-roll

**API è®¾è®¡**ï¼š
```http
POST /api/broll/ai/smart-match
{
  "project_id": "uuid",
  "timeline_position": 5000,  # æ¯«ç§’
  "context_window": 3000      # å‰å3ç§’çš„å†…å®¹
}

Response:
{
  "suggestions": [
    {
      "keyword": "nature",
      "videos": [Pexels video objects],
      "relevance": 0.92
    }
  ]
}
```

### 3.3 æ‰¹é‡å¯¼å…¥ B-roll

**åœºæ™¯**ï¼šä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ª B-roll è§†é¢‘åˆ°æ—¶é—´è½´

**API è®¾è®¡**ï¼š
```http
POST /api/broll/batch-import
{
  "project_id": "uuid",
  "track_id": "uuid",
  "videos": [
    { "video_id": 123, "position": 1000, "duration": 3000 },
    { "video_id": 456, "position": 5000, "duration": 4000 }
  ]
}
```

---

## Phase 4: å¤šæºæ”¯æŒ

### 4.1 Pixabay Video API é›†æˆ

**ç¯å¢ƒå˜é‡**ï¼š
```bash
PIXABAY_API_KEY=your_key_here
```

**API ç«¯ç‚¹**ï¼š
```http
GET /api/broll/pixabay/search?query=nature&page=1
```

**æ•°æ®è½¬æ¢**ï¼šå°† Pixabay å“åº”æ ¼å¼è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼

### 4.2 Kling AI è§†é¢‘ç”Ÿæˆé›†æˆ

**æ ¸å¿ƒæ”¹åŠ¨**ï¼šç”¨æˆ·å…ˆé€‰æ‹©æ¥æºï¼ˆæ ‡ç­¾é¡µï¼‰ï¼Œå†è¿›è¡Œæ“ä½œ

**å‰ç«¯äº¤äº’**ï¼š
- é¡¶éƒ¨æ ‡ç­¾é¡µï¼š[ Pexels ] [ Pixabay ] [ Kling AI ]
- é€‰æ‹© Pexels/Pixabayï¼šæ˜¾ç¤ºæœç´¢æ¡† + è§†é¢‘ç½‘æ ¼åˆ—è¡¨
- é€‰æ‹© Kling AIï¼šæ˜¾ç¤º AI ç”Ÿæˆç•Œé¢

**Kling AI ç”Ÿæˆç•Œé¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¬ AI è§†é¢‘ç”Ÿæˆ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æè¿°åœºæ™¯ï¼š                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ A beautiful sunset...    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚
â”‚  æ—¶é•¿ï¼š[ 5ç§’ â–¼]               â”‚
â”‚  æ¯”ä¾‹ï¼š[ 16:9 â–¼]              â”‚
â”‚                                â”‚
â”‚  [ ç”Ÿæˆè§†é¢‘ ]                 â”‚
â”‚                                â”‚
â”‚  ç”Ÿæˆå†å²ï¼š                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¬ Sunset video (ç”Ÿæˆä¸­)  â”‚  â”‚
â”‚  â”‚ ğŸ¬ City view (å·²å®Œæˆ)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API ç«¯ç‚¹**ï¼š
```http
POST /api/broll/kling/generate
{
  "project_id": "uuid",
  "prompt": "A beautiful sunset over the ocean",
  "duration": 5,
  "aspect_ratio": "16:9"
}

Response:
{
  "task_id": "uuid",
  "status": "processing"
}

GET /api/broll/kling/tasks?project_id=uuid
Response: {
  "tasks": [
    {
      "task_id": "uuid",
      "prompt": "...",
      "status": "completed",
     å‰ç«¯æ¥æºé€‰æ‹©å™¨ï¼ˆæ ‡ç­¾é¡µåˆ‡æ¢ï¼‰
4. âœ… Pixabay API é›†æˆï¼ˆPhase 4ï¼‰
5. âœ… Kling AI ç”Ÿæˆç•Œé¢ï¼ˆPhase 4ï¼‰

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®ç°ï¼‰
6. âš ï¸ æ™ºèƒ½åŒ¹é…åœºæ™¯ï¼ˆPhase 3ï¼‰

### ä½ä¼˜å…ˆçº§ï¼ˆæš‚ä¸å®ç°ï¼‰
- âŒ æœç´¢å†å²ï¼ˆæš‚ä¸éœ€è¦ï¼‰
- âŒ æ”¶è—åŠŸèƒ½ï¼ˆåç»­ç»Ÿä¸€å®ç°ï¼‰
- âŒ é«˜çº§ç­›é€‰ï¼ˆæ—¶é•¿ã€FPSã€è‰²è°ƒï¼‰
- âŒ AI å…³é”®è¯ç”Ÿæˆ
- âŒ æ‰¹é‡å¯¼å…¥

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. âœ… è§†é¢‘ä¸‹è½½åˆ°é¡¹ç›®èµ„æºåº“ï¼ˆPhase 2 æ ¸å¿ƒï¼‰
2. âœ… ä¸‹è½½è¿›åº¦æŒ‡ç¤ºå™¨
3. âœ… æœç´¢å†å²å’Œæ”¶è—
4. âœ… Pixabay å’Œ Unsplash å¤šæºæ”¯æŒï¼ˆPhase 4ï¼‰

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®ç°ï¼‰
5. âš ï¸ æ›´å¤šç­›é€‰é€‰é¡¹ï¼ˆæ—¶é•¿ã€FPSã€è‰²è°ƒï¼‰
6. âš ï¸ AI ç”Ÿæˆå…³é”®è¯ï¼ˆPhase 3ï¼‰
7. âš ï¸ Kling AI è§†é¢‘ç”Ÿæˆé›†æˆ

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
8. ğŸ’¡ æ™ºèƒ½åŒ¹é…åœºæ™¯ï¼ˆéœ€è¦æ›´å¤æ‚çš„ AI é€»è¾‘ï¼‰
9. ğŸ’¡ æ‰¹é‡å¯¼å…¥ B-roll

---

## æŠ€æœ¯æ ˆ

### åç«¯
- FastAPI (å¼‚æ­¥ä¸‹è½½ä»»åŠ¡)
- Celery (åå°ä»»åŠ¡é˜Ÿåˆ—)
- Redis (ä»»åŠ¡çŠ¶æ€ç¼“å­˜)
- httpx (HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒæµå¼ä¸‹è½½)
- OpenAI SDK (AI å…³é”®è¯æå–)

### å‰ç«¯
- React + TypeScript
- Zustand (çŠ¶æ€ç®¡ç†)
- lucide-react (å›¾æ ‡)
- Tailwind CSS (æ ·å¼)

---

## å¼€Sprint 1: Phase 2 æ ¸å¿ƒåŠŸèƒ½ï¼ˆè§†é¢‘ä¸‹è½½ï¼‰
- [ ] æ•°æ®åº“ schema æ›´æ–°ï¼ˆæ·»åŠ  broll_metadata å­—æ®µï¼‰
- [ ] åç«¯ä¸‹è½½ä»»åŠ¡å®ç°ï¼ˆCeleryï¼‰
- [ ] ä¸‹è½½è¿›åº¦æŸ¥è¯¢ API
- [ ] å‰ç«¯ä¸‹è½½æŒ‰é’® + è¿›åº¦æ¡

### Sprint 2: Phase 4 å¤šæºæ”¯æŒ
- [ ] å‰ç«¯æ ‡ç­¾é¡µåˆ‡æ¢ï¼ˆPexels / Pixabay / Kling AIï¼‰
- [ ] Pixabay API é›†æˆ
- [ ] ç»Ÿä¸€è§†é¢‘æ•°æ®æ ¼å¼
- [ ] å‰ç«¯æ˜¾ç¤ºæ¥æºæ ‡ç­¾

### Sprint 3: Kling AI é›†æˆ
- [ ] Kling AI ç”Ÿæˆç•Œé¢è®¾è®¡
- [ ] åç«¯ Kling API è°ƒç”¨
- [ ] ç”Ÿæˆå†å²åˆ—è¡¨
- [ ] è¿›åº¦çŠ¶æ€è½®è¯¢

### Sprint 4: Phase 3 AI æ™ºèƒ½åŒ¹é…ï¼ˆå¯é€‰ï¼‰
- [ ] æ™ºèƒ½åŒ¹é… API
- [ ] å‰ç«¯æ¨èç•Œé¢
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¹¶å‘ä¸‹è½½ã€ç¼“å­˜ï¼‰
- [ ] é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›
