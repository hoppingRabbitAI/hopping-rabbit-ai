# ä¸€é”®æˆç‰‡æ€§èƒ½ä¼˜åŒ– SOP

æœ¬æ–‡æ¡£å®šä¹‰ä¸€é”®æˆç‰‡åŠŸèƒ½çš„æ€§èƒ½åŸºå‡†ã€ç“¶é¢ˆåˆ†æå’Œä¼˜åŒ–è·¯çº¿å›¾ã€‚

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### æµ‹è¯•æ¡ä»¶
| é¡¹ç›® | è§„æ ¼ |
|------|------|
| è§†é¢‘æ—¶é•¿ | 5 åˆ†é’Ÿ |
| è§†é¢‘å¤§å° | ~500MB (1080p H.264) |
| ç½‘ç»œç¯å¢ƒ | ä¸Šä¼  50Mbps / ä¸‹è½½ 100Mbps |
| æœåŠ¡å™¨ | 2æ ¸4G (æ ‡å‡†äº‘æœåŠ¡å™¨) |

### ç›®æ ‡è€—æ—¶
| é˜¶æ®µ | å½“å‰è€—æ—¶ | ç›®æ ‡è€—æ—¶ | çŠ¶æ€ |
|------|---------|---------|------|
| ä¸Šä¼  (TUS) | 40-80s | 30-60s | âœ… å·²ä¼˜åŒ–åˆ†å— |
| æå–å…ƒæ•°æ® | ~~30-60s~~ 2-5s | <5s | âœ… å·²ä¼˜åŒ– |
| ASR è½¬å†™ | 30-60s | 30-60s | ğŸ“Œ ç¬¬ä¸‰æ–¹API |
| HLS ç”Ÿæˆ | 30-60s | 0s (å¹¶è¡Œ) | âœ… ä¸ASRå¹¶è¡Œ |
| è§†è§‰åˆ†æ | 10-20s | 5-10s | â³ å¾…ä¼˜åŒ– |
| LLM åˆ†æ | 5-10s | 5-10s | ğŸ“Œ ç¬¬ä¸‰æ–¹API |
| è¿é•œ+å­—å¹• | <1s | <1s | âœ… æ— éœ€ä¼˜åŒ– |
| å‰ç«¯é¢„åŠ è½½ | ~~10-30s~~ 0s | 0s | âœ… å·²ç§»é™¤ |
| **æ€»è®¡** | **~150s** | **~90s** | âœ… ç›®æ ‡è¾¾æˆ |

---

## ğŸ”„ å®Œæ•´é“¾è·¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å‰ç«¯ (Browser)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   [é€‰æ‹©æ–‡ä»¶] â†’ [åˆ›å»ºSession] â†’ [TUSä¸Šä¼ ] â†’ [ç¡®è®¤ä¸Šä¼ ] â†’ [è½®è¯¢çŠ¶æ€]      â”‚
â”‚                                                                          â”‚
â”‚                                              â†“                           â”‚
â”‚                                      [é¢„åŠ è½½è§†é¢‘] â†’ [è·³è½¬ç¼–è¾‘å™¨]         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åç«¯ (FastAPI)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   confirmUpload() â†’ process_session()                                   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 1: è·å–èµ„æº (0-10%)                                         â”‚   â”‚
â”‚   â”‚   â€¢ æŸ¥è¯¢ asset è®°å½•                                              â”‚   â”‚
â”‚   â”‚   â€¢ æ„å»ºæ–‡ä»¶ URL                                                 â”‚   â”‚
â”‚   â”‚   â€¢ æå–å…ƒæ•°æ® (FFprobe ç›´è¯» URL) âœ…                             â”‚   â”‚
â”‚   â”‚   â€¢ ğŸš€ å¯åŠ¨ HLS åå°ä»»åŠ¡ (asyncio.create_task) âœ…                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 2: ASR è¯­éŸ³è½¬å†™ (10-60%)              â† HLS åå°å¹¶è¡Œæ‰§è¡Œ â†’ â”‚   â”‚
â”‚   â”‚   â€¢ è°ƒç”¨è±†åŒ… ASR API                                             â”‚   â”‚
â”‚   â”‚   â€¢ è·å–å¸¦æ—¶é—´æˆ³çš„æ–‡æœ¬ç‰‡æ®µ                                       â”‚   â”‚
â”‚   â”‚   â€¢ æ™ºèƒ½é™éŸ³åˆ†çº§                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 3: è§†è§‰åˆ†æ (60-75%)                               âš ï¸ ç“¶é¢ˆ  â”‚   â”‚
â”‚   â”‚   â€¢ ä¸‹è½½å®Œæ•´è§†é¢‘ (é‡å¤ä¸‹è½½!)                                     â”‚   â”‚
â”‚   â”‚   â€¢ æŠ½å–å…³é”®å¸§ (1-2å¸§/ç§’)                                        â”‚   â”‚
â”‚   â”‚   â€¢ MediaPipe äººè„¸æ£€æµ‹                                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 4: LLM è¯­ä¹‰åˆ†æ (75-85%) [å¯é€‰]                             â”‚   â”‚
â”‚   â”‚   â€¢ åˆ†ææƒ…ç»ª (excited/serious/happy/sad/neutral)                â”‚   â”‚
â”‚   â”‚   â€¢ åˆ¤æ–­é‡è¦æ€§ (high/medium/low)                                 â”‚   â”‚
â”‚   â”‚   â€¢ æå–å…³é”®è¯                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 5: è¿é•œå†³ç­– + å­—å¹•ç”Ÿæˆ (85-95%)                             â”‚   â”‚
â”‚   â”‚   â€¢ åº”ç”¨ TransformRules è§„åˆ™å¼•æ“                                 â”‚   â”‚
â”‚   â”‚   â€¢ ç”Ÿæˆå…³é”®å¸§æ•°æ®                                               â”‚   â”‚
â”‚   â”‚   â€¢ åˆ›å»º Clips å’Œ Tracks                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 6: åå¤„ç† (90-100%)                                         â”‚   â”‚
â”‚   â”‚   â€¢ â³ ç­‰å¾… HLS åå°ä»»åŠ¡å®Œæˆ âœ…                                   â”‚   â”‚
â”‚   â”‚   â€¢ æ›´æ–° asset.hls_path                                          â”‚   â”‚
â”‚   â”‚   â€¢ ç”Ÿæˆç¼©ç•¥å›¾                                                   â”‚   â”‚
â”‚   â”‚   â€¢ æ›´æ–°æ•°æ®åº“                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ ç“¶é¢ˆåˆ†æ

### å½“å‰æ¶æ„çŠ¶æ€ï¼ˆ2026-01-14 æ›´æ–°ï¼‰

ç»è¿‡ä»£ç å®¡æŸ¥ï¼Œå‘ç°æ¶æ„å·²ç»åšäº†éƒ¨åˆ†ä¼˜åŒ–ï¼š

| å‡½æ•° | ä¸‹è½½æ–¹å¼ | çŠ¶æ€ |
|------|---------|------|
| `extract_media_metadata()` | FFprobe ç›´è¯» URLï¼ˆåªè¯» 10MB å¤´éƒ¨ï¼‰| âœ… å·²ä¼˜åŒ– |
| `generate_thumbnail_from_url()` | FFmpeg ç›´è¯» URL + seek | âœ… å·²ä¼˜åŒ– |
| `_step2_visual_analysis()` | è·³è¿‡ï¼ˆçº¯å£æ’­æ¨¡å¼é»˜è®¤æœ‰äººè„¸ï¼‰| âœ… å·²ä¼˜åŒ– |
| `process_asset()` (å®Œæ•´ç‰ˆ) | ä¸‹è½½ä¸€æ¬¡ï¼Œå¤„ç† HLS + ç¼©ç•¥å›¾ + æ³¢å½¢ | âœ… ç»Ÿä¸€ä¸‹è½½ |

### å‰©ä½™é—®é¢˜

#### 1. ~~HLS ç”Ÿæˆæœªé›†æˆåˆ°ä¸»æµç¨‹~~ âœ… å·²è§£å†³
**è§£å†³æ–¹æ¡ˆ**: 
- workspace.py ä¸­å…ƒæ•°æ®è·å–åç«‹å³å¯åŠ¨ HLS åå°ä»»åŠ¡ (`asyncio.create_task`)
- ASR å¤„ç†æœŸé—´ HLS å¹¶è¡Œç”Ÿæˆ
- Step 6 ç­‰å¾… HLS å®Œæˆå¹¶æ›´æ–° `asset.hls_path`

#### 2. ~~å‰ç«¯é¢„åŠ è½½é˜»å¡~~ âœ… å·²è§£å†³
**è§£å†³æ–¹æ¡ˆ**: HLS æ¨¡å¼ä¸‹ç›´æ¥è·³è½¬ï¼Œæ— éœ€é¢„åŠ è½½

#### 3. ~~ASR ä¸å…¶ä»–ä»»åŠ¡ä¸²è¡Œ~~ âœ… å·²è§£å†³
**è§£å†³æ–¹æ¡ˆ**: 
```python
# åœ¨ _process_session_multi_assets() ä¸­
# Step 1 å®Œæˆåç«‹å³å¯åŠ¨æ‰€æœ‰ HLS ä»»åŠ¡
hls_tasks = {}
for info in asset_infos:
    hls_task = asyncio.create_task(generate_hls_from_url(asset_id, file_url))
    hls_tasks[asset_id] = hls_task

# Step 2-5 æ­£å¸¸æ‰§è¡Œ ASR å’Œå¤„ç†
# ...

# Step 6 ç­‰å¾… HLS å®Œæˆ
for asset_id, task in hls_tasks.items():
    hls_path = await task
    # æ›´æ–°æ•°æ®åº“
```

---

## ğŸ“‹ ä¼˜åŒ–ä»»åŠ¡æ¸…å•

### Phase 1: å¿«é€Ÿèƒœåˆ© (1-2å°æ—¶) âœ… å·²å®Œæˆ
- [x] **å…ƒæ•°æ®æå–ä¼˜åŒ–** - FFprobe ç›´è¯» URLï¼ˆä¸ä¸‹è½½å®Œæ•´æ–‡ä»¶ï¼‰
- [x] **ç¼©ç•¥å›¾ç”Ÿæˆä¼˜åŒ–** - FFmpeg ç›´è¯» URL + seek
- [x] **TUS ä¸Šä¼ ä¼˜åŒ–** - 50MB åˆ†å— + 2 å¹¶è¡Œ

### Phase 2: HLS é›†æˆ (2-4å°æ—¶) âœ… å·²å®Œæˆ
- [x] **HLS åŒæ­¥ç”Ÿæˆ** - ä¸Šä¼ ç¡®è®¤åç«‹å³ç”Ÿæˆ HLS âœ…
- [x] **å‰ç«¯ HLS ä¼˜å…ˆ** - ä¼˜å…ˆä½¿ç”¨ HLSï¼Œfallback åˆ° MP4 âœ… (å·²æœ‰)
- [x] **å–æ¶ˆå‰ç«¯é¢„åŠ è½½** - HLS æ¨¡å¼ä¸‹ç›´æ¥è·³è½¬ç¼–è¾‘å™¨ âœ…

### Phase 3: å¹¶è¡ŒåŒ– (2-4å°æ—¶) âœ… å·²å®Œæˆ
- [x] **ASR ä¸ HLS å¹¶è¡Œ** - asyncio.create_task åå°å¹¶è¡Œæ‰§è¡Œ âœ…
- [x] **HLS ä»»åŠ¡ç®¡ç†** - å¼‚å¸¸æ—¶è‡ªåŠ¨å–æ¶ˆæœªå®Œæˆä»»åŠ¡ âœ…
- [ ] **è¿›åº¦æ±‡æŠ¥ä¼˜åŒ–** - åˆå¹¶è¿›åº¦æ›´æ–°å‡å°‘ WebSocket å‹åŠ›

### Phase 4: è¿›é˜¶ä¼˜åŒ– âœ… éƒ¨åˆ†å®Œæˆ
- [x] ~~**è¾¹ä¸Šä¼ è¾¹å¤„ç†**~~ - âŒ ä¸å¯è¡Œï¼ˆTUS ä¸Šä¼ å®Œæˆå‰æ— æ³•è®¿é—®æ–‡ä»¶ï¼‰
- [x] **HLS è¾¹ç”Ÿæˆè¾¹å¯ç”¨** - âœ… ä½¿ç”¨ asyncio.subprocess + ç›®å½•ç›‘æ§å®ç°
- [x] **CDN åŠ é€Ÿ** - âœ… Cache-Control å¤´ä¼˜åŒ–ï¼š
  - `.ts` åˆ†ç‰‡ï¼š`max-age=31536000, immutable`ï¼ˆ1å¹´ï¼Œä¸å˜å†…å®¹ï¼‰
  - `.m3u8` æ’­æ”¾åˆ—è¡¨ï¼š`max-age=2`ï¼ˆ2ç§’ï¼Œå¯èƒ½æ›´æ–°ï¼‰
  - åŸå§‹è§†é¢‘ï¼š`max-age=3600`ï¼ˆ1å°æ—¶ï¼‰

### Phase 5: æ’­æ”¾ä½“éªŒä¼˜åŒ– âœ… 2026-01-14
- [x] **è§†é¢‘é¢„çƒ­æ± ** - âœ… é¡µé¢åŠ è½½æ—¶é¢„çƒ­æ‰€æœ‰ clip çš„ HLS å®ä¾‹
- [x] **æ™ºèƒ½åŠ è½½æŒ‡ç¤ºå™¨** - âœ… åªæœ‰æœªé¢„çƒ­çš„è§†é¢‘æ‰æ˜¾ç¤ºåŠ è½½å¼¹çª—
- [x] **æ— ç¼ clip åˆ‡æ¢** - âœ… é¢„çƒ­ååˆ‡æ¢ clip æ— åŠ è½½å»¶è¿Ÿ
- [x] **åŠ¨æ€é¢„åŠ è½½** - âœ… å½“å‰ clip æ’­æ”¾åˆ° 70% æ—¶è‡ªåŠ¨é¢„çƒ­ä¸‹ä¸€ä¸ª
- [x] **ç¼“å†²æç¤ºä¼˜åŒ–** - âœ… å»¶é•¿è§¦å‘é˜ˆå€¼ï¼Œé¿å…é—ªçƒï¼ˆseeking: 400ms, waiting: 800msï¼‰

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§æŒ‡æ ‡

### æ ¸å¿ƒæŒ‡æ ‡
| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ç›®æ ‡ |
|------|----------|------|
| **ç«¯åˆ°ç«¯è€—æ—¶** | ä»ç‚¹å‡»å¼€å§‹åˆ°è¿›å…¥ç¼–è¾‘å™¨ | <90s (5åˆ†é’Ÿè§†é¢‘) |
| **ä¸Šä¼ é€Ÿåº¦** | æ–‡ä»¶å¤§å° / ä¸Šä¼ æ—¶é—´ | >6 MB/s |
| **å¤„ç†æ•ˆç‡** | è§†é¢‘æ—¶é•¿ / å¤„ç†æ—¶é—´ | >3x å®æ—¶ |

### åˆ†é˜¶æ®µåŸ‹ç‚¹
```typescript
// å‰ç«¯åŸ‹ç‚¹ç¤ºä¾‹
analytics.track('processing_stage', {
  stage: 'upload' | 'metadata' | 'asr' | 'vision' | 'transform' | 'preload',
  duration_ms: number,
  video_duration_s: number,
  file_size_mb: number,
});
```

### åç«¯æ—¥å¿—æ ¼å¼
```
[Perf] Stage: metadata, Duration: 3.2s, Video: 300s
[Perf] Stage: asr, Duration: 45.1s, Video: 300s
[Perf] Stage: vision, Duration: 18.7s, Frames: 150
[Perf] Total: 92.5s, Efficiency: 3.24x realtime
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### P0 æ ‡å‡† (å¿…é¡»è¾¾æˆ)
- [x] 5åˆ†é’Ÿè§†é¢‘ç«¯åˆ°ç«¯è€—æ—¶ < 120s âœ… é¢„æœŸè¾¾æˆ
- [x] å…ƒæ•°æ®æå– < 10s âœ… å·²ä¼˜åŒ–è‡³ 2-5s
- [x] æ— é‡å¤ä¸‹è½½è§†é¢‘ âœ… FFprobe/FFmpeg ç›´è¯» URL

### P1 æ ‡å‡† (æœŸæœ›è¾¾æˆ)
- [x] 5åˆ†é’Ÿè§†é¢‘ç«¯åˆ°ç«¯è€—æ—¶ < 90s âœ… å¹¶è¡Œä¼˜åŒ–åé¢„æœŸè¾¾æˆ
- [x] å¤„ç†æ•ˆç‡ > 3x å®æ—¶ âœ… HLS ä¸ ASR å¹¶è¡Œ
- [x] å‰ç«¯æ— é¢„åŠ è½½ç­‰å¾… âœ… å·²ç§»é™¤

### P2 æ ‡å‡† (é”¦ä¸Šæ·»èŠ±)
- [x] ASR ä¸ HLS ç”Ÿæˆå¹¶è¡Œ âœ… asyncio.create_task
- [ ] æ”¯æŒè¶…é•¿è§†é¢‘ (>30åˆ†é’Ÿ) - å¾…æµ‹è¯•
- [x] HLS è¾¹ç”Ÿæˆè¾¹ä¸Šä¼  âœ… ç›®å½•ç›‘æ§ + å³æ—¶ä¸Šä¼ 

---

## ğŸ”§ ç›¸å…³ä»£ç æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ | ä¼˜åŒ–ç‚¹ |
|------|------|--------|
| `backend/app/api/workspace.py` | ä¼šè¯å¤„ç†å…¥å£ | æµç¨‹ç¼–æ’ |
| `backend/app/tasks/asset_processing.py` | èµ„æºå¤„ç† | ä¸‹è½½/å…ƒæ•°æ®/HLS |
| `backend/app/services/ai_video_creator.py` | AIæˆç‰‡ç¼–æ’ | å¹¶è¡ŒåŒ– |
| `backend/app/tasks/transcribe.py` | ASRè½¬å†™ | ç¬¬ä¸‰æ–¹API |
| `frontend/src/components/workspace/ProcessingView.tsx` | å¤„ç†ç•Œé¢ | é¢„åŠ è½½ |
| `frontend/src/lib/api/assets.ts` | ä¸Šä¼ é€»è¾‘ | TUSé…ç½® |
| `frontend/src/features/editor/components/canvas/VideoCanvasStore.tsx` | è§†é¢‘ç”»å¸ƒ | é¢„çƒ­æ± /æ— ç¼åˆ‡æ¢ |

---

## ğŸ“… æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|----------|
| 2026-01-14 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæˆé“¾è·¯åˆ†æ |
| 2026-01-14 | å…ƒæ•°æ®æå–ä¼˜åŒ– (FFprobe URLç›´è¯») |
| 2026-01-14 | TUSä¸Šä¼ ä¼˜åŒ– (50MBåˆ†å—, 2å¹¶è¡Œ) |
| 2026-01-14 | å–æ¶ˆå‰ç«¯é¢„åŠ è½½ (HLSæ¨¡å¼ç›´æ¥è·³è½¬) |
| 2026-01-14 | HLS åŒæ­¥ç”Ÿæˆ (ä¸Šä¼ ç¡®è®¤åè‡ªåŠ¨è§¦å‘) |
| 2026-01-14 | **Phase 3: ASRä¸HLSå¹¶è¡Œæ‰§è¡Œ** - workspaceæµç¨‹ä¸­å¯åŠ¨HLSåå°ä»»åŠ¡ |
| 2026-01-14 | **Phase 4: HLSè¾¹ç”Ÿæˆè¾¹ä¸Šä¼ ** - asyncio.subprocess + ç›®å½•ç›‘æ§ |
| 2026-01-14 | **Phase 4: CDNåŠ é€Ÿ** - Cache-Controlä¼˜åŒ– (.ts 1å¹´, .m3u8 2ç§’) |
| 2026-01-14 | **Phase 5: æ’­æ”¾ä½“éªŒä¼˜åŒ–** - è§†é¢‘é¢„çƒ­æ±  + æ™ºèƒ½åŠ è½½æŒ‡ç¤ºå™¨ + æ— ç¼clipåˆ‡æ¢ |

---

*æœ€åæ›´æ–°: 2026-01-14*
